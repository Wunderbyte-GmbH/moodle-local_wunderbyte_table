define("local_wunderbyte_table/actionbutton",["exports","core/modal_factory","core/modal_events","core/ajax","local_wunderbyte_table/notifications","local_wunderbyte_table/reload","core/str","core_form/modalform"],(function(_exports,_modal_factory,_modal_events,_ajax,_notifications,_reload,_str,_modalform){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initializeActionButton=function(selector,idstring,encodedtable){document.querySelector(selector).querySelectorAll(SELECTOR_ACTIONBUTTON).forEach((function(button){button.dataset.initialized||(button.dataset.initialized=!0,button.dataset.methodname&&button.dataset.methodname.length>0?button.dataset.ischeckbox?button.addEventListener("change",(function(){var data=button.dataset;data.state=button.checked,console.log(data.state),transmitAction(button.dataset.id,button.dataset.methodname,JSON.stringify(data),idstring,encodedtable)})):button.addEventListener("click",_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var selectionresult,selectionmandatory;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,getSelectionData(idstring,button.dataset);case 2:if(selectionresult=_context.sent,"1"!=button.dataset.selectionmandatory&&1!=button.dataset.selectionmandatory&&"true"!=button.dataset.selectionmandatory||(selectionmandatory=!0),!(selectionmandatory&&selectionresult.checkedids.length<1)){_context.next=9;break}return showNoCheckboxNotification(),_context.abrupt("return");case 9:"true"===button.dataset.nomodal||"1"===button.dataset.nomodal?chooseActionToTransmit(button,idstring,encodedtable,selectionresult):showConfirmationModal(button,idstring,encodedtable,selectionresult);case 10:case"end":return _context.stop()}}),_callee)})))):button.dataset.formname&&button.dataset.formname.length>0&&button.addEventListener("click",(function(e){var target=e.target;console.log("transmit data",target),function(button,titleText,bodyText,saveButtonText,idstring,encodedtable){console.log(button,bodyText,saveButtonText,idstring,encodedtable);var formname=button.dataset.formname,data=button.dataset;data.id=button.dataset.id,console.log(data);var modalForm=new _modalform.default({formClass:formname,args:data,modalConfig:{title:titleText},returnFocus:button});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(function(e){console.log(e.detail),(0,_reload.reloadAllTables)()})),modalForm.show()}(button,"title","body","button",idstring,encodedtable)})))}))},_exports.transmitAction=transmitAction,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_modalform=_interopRequireDefault(_modalform);var SELECTOR_ACTIONBUTTON=".wb_action_button",SELECTOR_CHECKBOX="input.wb-checkbox";function showConfirmationModal(_x,_x2,_x3,_x4){return _showConfirmationModal.apply(this,arguments)}function _showConfirmationModal(){return(_showConfirmationModal=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(button,idstring,encodedtable,result){var _result$labelstring,datastring,strings,_button$dataset$title,_button$dataset$compo,_button$dataset$bodys,_button$dataset$compo2,_button$dataset$submi,_button$dataset$compo3,_button$dataset$title2,_button$dataset$compo4,_button$dataset$nosel,_button$dataset$compo5,_button$dataset$submi2,_button$dataset$compo6,localizedstrings;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return datastring=null!==(_result$labelstring=result.labelstring)&&void 0!==_result$labelstring?_result$labelstring:"",strings=[],strings=result.labelstring.length>0?[{key:null!==(_button$dataset$title=button.dataset.titlestring)&&void 0!==_button$dataset$title?_button$dataset$title:"generictitle",component:null!==(_button$dataset$compo=button.dataset.component)&&void 0!==_button$dataset$compo?_button$dataset$compo:"local_wunderbyte_table"},{key:null!==(_button$dataset$bodys=button.dataset.bodystring)&&void 0!==_button$dataset$bodys?_button$dataset$bodys:"genericbody",component:null!==(_button$dataset$compo2=button.dataset.component)&&void 0!==_button$dataset$compo2?_button$dataset$compo2:"local_wunderbyte_table",param:{data:datastring}},{key:null!==(_button$dataset$submi=button.dataset.submitbuttonstring)&&void 0!==_button$dataset$submi?_button$dataset$submi:"genericsubmit",component:null!==(_button$dataset$compo3=button.dataset.component)&&void 0!==_button$dataset$compo3?_button$dataset$compo3:"local_wunderbyte_table"}]:[{key:null!==(_button$dataset$title2=button.dataset.titlestring)&&void 0!==_button$dataset$title2?_button$dataset$title2:"generictitle",component:null!==(_button$dataset$compo4=button.dataset.component)&&void 0!==_button$dataset$compo4?_button$dataset$compo4:"local_wunderbyte_table"},{key:null!==(_button$dataset$nosel=button.dataset.noselectionbodystring)&&void 0!==_button$dataset$nosel?_button$dataset$nosel:"noselectionbody",component:null!==(_button$dataset$compo5=button.dataset.component)&&void 0!==_button$dataset$compo5?_button$dataset$compo5:"local_wunderbyte_table"},{key:null!==(_button$dataset$submi2=button.dataset.submitbuttonstring)&&void 0!==_button$dataset$submi2?_button$dataset$submi2:"genericsubmit",component:null!==(_button$dataset$compo6=button.dataset.component)&&void 0!==_button$dataset$compo6?_button$dataset$compo6:"local_wunderbyte_table"}],_context2.next=5,(0,_str.get_strings)(strings);case 5:localizedstrings=_context2.sent,_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setTitle(localizedstrings[0]),modal.setBody(localizedstrings[1]),modal.setSaveButtonText(localizedstrings[2]),modal.getRoot().on(_modal_events.default.save,(function(){chooseActionToTransmit(button,idstring,encodedtable,result)})),modal.show(),modal})).catch((function(e){console.log(e)}));case 7:case"end":return _context2.stop()}}),_callee2)})))).apply(this,arguments)}function getSelectionData(_x5,_x6){return _getSelectionData.apply(this,arguments)}function _getSelectionData(){return(_getSelectionData=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(idstring,data){var _labelarray$join,result,checkedids,labelarray,datastring;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return result=getIds(data.id,idstring,data),checkedids=result.checkedids,labelarray=result.labelarray,datastring=null!==(_labelarray$join=labelarray.join("<br>"))&&void 0!==_labelarray$join?_labelarray$join:"",_context3.abrupt("return",{checkedids:checkedids,labelstring:datastring});case 5:case"end":return _context3.stop()}}),_callee3)})))).apply(this,arguments)}function showNoCheckboxNotification(){return _showNoCheckboxNotification.apply(this,arguments)}function _showNoCheckboxNotification(){return(_showNoCheckboxNotification=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var message;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,(0,_str.get_string)("nocheckboxchecked","local_wunderbyte_table");case 2:message=_context4.sent,(0,_notifications.showNotification)(message,"danger");case 4:case"end":return _context4.stop()}}),_callee4)})))).apply(this,arguments)}function transmitAction(id,methodname,datastring,idstring,encodedtable){_ajax.default.call([{methodname:"local_wunderbyte_table_execute_action",args:{id:parseInt(id),methodname:methodname,data:datastring,encodedtable:encodedtable},done:function(data){1==data.success?(0,_notifications.showNotification)(data.message,"success"):(0,_notifications.showNotification)(data.message,"danger"),(0,_reload.reloadAllTables)()},fail:function(ex){console.log("ex:"+ex),(0,_notifications.showNotification)("row "+id+" was not treated","danger")}}])}function getIds(id,idstring,data){var checkedids=[],labelarray=[],container=document.querySelector("#a"+idstring);id<1?container.querySelectorAll(SELECTOR_CHECKBOX).forEach((function(x){x.checked&&(labelarray.push(returnLabel(x.id,data.labelcolumn)),checkedids.push(x.id))})):(labelarray.push(returnLabel(id,data.labelcolumn)),checkedids.push(id));return{checkedids:checkedids,labelarray:labelarray};function returnLabel(id,label){try{return container.querySelector('[data-id="'+id+'"] [data-label="'+label+'"]').textContent}catch(e){return""+id}}}function chooseActionToTransmit(button,idstring,encodedtable,selectionresult){var _selectionresult$chec,data=button.dataset,id=parseInt(button.dataset.id),methodname=button.dataset.methodname,checkedids=null!==(_selectionresult$chec=selectionresult.checkedids)&&void 0!==_selectionresult$chec?_selectionresult$chec:[];if(0===checkedids.length)return console.log("no ids checked"),void transmitAction(button.dataset.id,button.dataset.methodname,JSON.stringify(button.dataset),0,encodedtable);0!=id?(console.log("single call"),transmitAction(id,methodname,JSON.stringify(_objectSpread(_objectSpread({},data),{},{checkedids:checkedids})),0,encodedtable)):(console.log("multiple call"),checkedids.forEach((function(cid){transmitAction(cid,methodname,JSON.stringify(data),0,encodedtable)})))}}));

//# sourceMappingURL=actionbutton.min.js.map
{"version":3,"file":"filter.min.js","sources":["../src/filter.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getSearchInput} from 'local_wunderbyte_table/search';\nimport {getSortSelection} from 'local_wunderbyte_table/sort';\n\nimport {callLoadData} from 'local_wunderbyte_table/init';\nimport Templates from 'core/templates';\n\n// These variables are specific to the filter.\nvar checked = {};\n// var categories = {};\n\n/**\n * Initialize Checkboxes.\n * @param {string} selector\n * @param {string} idstring\n * @param {string} encodedtable\n */\n export function initializeCheckboxes(selector, idstring, encodedtable) {\n\n  const filterContainer = document.querySelector(selector + \" .wunderbyteTableFilter\");\n\n  if (!filterContainer || filterContainer.dataset.initialized) {\n    return;\n  }\n\n  const allCheckboxes = filterContainer.querySelectorAll(\"input[type=checkbox]\");\n\n  if (!allCheckboxes) {\n      return;\n  }\n\n  // We create the key for the checked items of this table.\n  if (!checked.hasOwnProperty(idstring)) {\n    checked[idstring] = {};\n  }\n\n  // filterContainer.querySelectorAll(\".form-group\").forEach(e => {\n\n  //     if (!categories || !categories.hasOwnProperty(idstring)) {\n  //       categories[idstring] = [];\n  //     }\n\n  //     categories[idstring].push(e.getAttribute(\"name\"));\n  //     getChecked(e.getAttribute(\"name\"), selector, idstring);\n  // });\n\n  allCheckboxes.forEach(el => {\n      el.addEventListener(\"change\", (e) => toggleCheckbox(e, selector, idstring, encodedtable));\n  });\n\n  filterContainer.dataset.initialized = true;\n}\n\n\n/**\n * Eventhandler\n * @param {*} e\n * @param {*} selector\n * @param {*} idstring\n* @param {*} encodedtable\n */\n export function toggleCheckbox(e, selector, idstring, encodedtable) {\n\n  getChecked(e.target.name, selector, idstring);\n\n  // Reload the filtered elements via ajax.\n\n  const filterobjects = getFilterOjects(idstring);\n  const searchstring = getSearchInput(idstring);\n  const sort = getSortSelection(idstring);\n\n  // The filter reloads data from the Server.\n  // Because of pages and infinite scroll we don't have the data to do without.\n  callLoadData(idstring,\n    encodedtable,\n    0, // Pagenumber is always rest to 0.\n    null,\n    sort,\n    null,\n    null,\n    null,\n    filterobjects,\n    searchstring);\n}\n\n  /**\n   * Gets an array of checkboxes for every table by idstring.\n   * @param {*} name\n   * @param {*} selector\n   * @param {*} idstring\n   * @returns {array}\n   */\n   export function getChecked(name, selector, idstring) {\n\n    // We might have more than one Table, therefore we first have to get all tables.\n\n    const wbTable = document.querySelector(selector);\n\n    checked[idstring][name] = Array.from(\n      wbTable.querySelectorAll(\"input[name=\" + name + \"]:checked\")\n    ).map(function(el) {\n      return el.value;\n    });\n\n  }\n\n  /**\n * Returns json of active filters as json.\n * @param {*} idstring\n * @returns {string}\n */\nexport function getFilterOjects(idstring) {\n\n  if (!(idstring in checked)) {\n    return '';\n  }\n\n  return JSON.stringify(checked[idstring]);\n}\n\n    /**\n   * Render the checkboxes for the filer.\n   * @param {string} filterjson\n   * @param {string} idstring\n   * @param {string} encodedtable\n   */\n     export const renderFilter = (filterjson, idstring, encodedtable) => {\n\n      // We render the filter only once, so if we find it already, we don't render it.\n\n      const selector = \".wunderbyte_table_container_\" + idstring;\n      const container = document.querySelector(selector);\n      const filtercontainer = container.querySelector(\".wunderbyteTableFilter\");\n\n      if (filtercontainer) {\n        return;\n      }\n\n      Templates.renderForPromise('local_wunderbyte_table/filter', filterjson).then(({html}) => {\n\n          container.insertAdjacentHTML('afterbegin', html);\n\n          initializeCheckboxes(selector, idstring, encodedtable);\n\n          return;\n      }).catch(e => {\n          // eslint-disable-next-line no-console\n          console.log(e);\n      });\n  };"],"names":["checked","initializeCheckboxes","selector","idstring","encodedtable","filterContainer","document","querySelector","dataset","initialized","allCheckboxes","querySelectorAll","hasOwnProperty","forEach","el","addEventListener","e","toggleCheckbox","getChecked","target","name","filterobjects","getFilterOjects","searchstring","sort","wbTable","Array","from","map","value","JSON","stringify","filterjson","container","renderForPromise","then","html","insertAdjacentHTML","catch","console","log"],"mappings":";;;;;8TA6BIA,QAAU,YASGC,qBAAqBC,SAAUC,SAAUC,kBAElDC,gBAAkBC,SAASC,cAAcL,SAAW,8BAErDG,kBAAmBA,gBAAgBG,QAAQC,iBAI1CC,cAAgBL,gBAAgBM,iBAAiB,wBAElDD,gBAKAV,QAAQY,eAAeT,YAC1BH,QAAQG,UAAY,IAatBO,cAAcG,SAAQ,SAAAC,IAClBA,GAAGC,iBAAiB,UAAU,SAACC,UAAMC,eAAeD,EAAGd,SAAUC,SAAUC,oBAG/EC,gBAAgBG,QAAQC,aAAc,aAWvBQ,eAAeD,EAAGd,SAAUC,SAAUC,cAErDc,WAAWF,EAAEG,OAAOC,KAAMlB,SAAUC,cAI9BkB,cAAgBC,gBAAgBnB,UAChCoB,cAAe,0BAAepB,UAC9BqB,MAAO,0BAAiBrB,iCAIjBA,SACXC,aACA,EACA,KACAoB,KACA,KACA,KACA,KACAH,cACAE,uBAUeL,WAAWE,KAAMlB,SAAUC,cAIpCsB,QAAUnB,SAASC,cAAcL,UAEvCF,QAAQG,UAAUiB,MAAQM,MAAMC,KAC9BF,QAAQd,iBAAiB,cAAgBS,KAAO,cAChDQ,KAAI,SAASd,WACNA,GAAGe,kBAUAP,gBAAgBnB,iBAExBA,YAAYH,QAIX8B,KAAKC,UAAU/B,QAAQG,WAHrB,yBAYsB,SAAC6B,WAAY7B,SAAUC,kBAI5CF,SAAW,+BAAiCC,SAC5C8B,UAAY3B,SAASC,cAAcL,UACjB+B,UAAU1B,cAAc,8CAMtC2B,iBAAiB,gCAAiCF,YAAYG,MAAK,mBAAEC,UAAAA,KAE3EH,UAAUI,mBAAmB,aAAcD,MAE3CnC,qBAAqBC,SAAUC,SAAUC,iBAG1CkC,OAAM,SAAAtB,GAELuB,QAAQC,IAAIxB"}
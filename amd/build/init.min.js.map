{"version":3,"sources":["../src/init.js"],"names":["loadings","scrollpages","tablejss","scrollingelement","init","idstring","encodedtable","console","log","hasOwnProperty","respondToVisibility","callLoadData","callback","identifier","element","document","querySelector","dataset","spinner","isHidden","observer","MutationObserver","disconnect","hiddenElement","returnHiddenElement","observe","attributes","replaceLinksInFrag","selector","addScrollFunctionality","getScrollParent","node","scrollHeight","clientHeight","parentNode","el","style","window","getComputedStyle","display","visibility","page","tsort","thide","tshow","tdir","treset","filterobjects","searchtext","replacerow","table","getElementById","classList","remove","add","Ajax","call","methodname","args","done","res","jsonobject","JSON","parse","content","rendertemplate","template","container","componentscontainer","rowtemplate","rows","promises","map","row","Templates","renderForPromise","then","html","js","filterobject","rowid","id","replaceNode","appendNodeContents","catch","e","promise","push","Promise","all","setTimeout","frag","firstChild","removeChild","lastChild","parent","parentElement","ex","Notification","addNotification","message","type","fail","err","createElement","textnode","createTextNode","appendChild","scrollinitialized","scrollableelement","addEventListener","scrollListener","elementtop","getBoundingClientRect","top","elementheight","height","screenheight","body","replaceSortColumnLinks","arrayOfItems","querySelectorAll","forEach","item","sortid","getAttribute","sortorder","setAttribute","replaceResetTableLink","length","classofelement","indexOf","listOfChildren","subitem","replacePaginationLinks","arrayOfPageItems","pageNumber","pagenumber","replaceDownloadLink","tagName","newnode","activepage"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nimport {initializeCheckboxes, getFilterOjects} from 'local_wunderbyte_table/filter';\nimport {initializeSearch, getSearchInput} from 'local_wunderbyte_table/search';\nimport {initializeSort, getSortSelection} from 'local_wunderbyte_table/sort';\nimport {initializeReload} from 'local_wunderbyte_table/reload';\n\n\n// All these variables will be objects with the idstringso their tables as identifiers.\nvar loadings = {};\nvar scrollpages = {};\nvar tablejss = {};\nvar scrollingelement = {};\n\n/**\n * Gets called from mustache template.\n * @param {string} idstring\n * @param {string} encodedtable\n */\nexport const init = (idstring, encodedtable) => {\n\n    // eslint-disable-next-line no-console\n    console.log('wb init', idstring);\n\n    if (idstring && encodedtable) {\n\n        if (!scrollpages.hasOwnProperty(idstring)) {\n            scrollpages[idstring] = 0;\n        }\n\n        respondToVisibility(idstring, encodedtable, callLoadData);\n    }\n};\n\n/**\n * React on visibility change.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {function} callback\n */\nfunction respondToVisibility(idstring, encodedtable, callback) {\n\n    const identifier = 'a' + idstring;\n    let element = document.querySelector('#' + identifier);\n\n    // If we find the table element AND if it has the encoded table set, we abort this.\n    // Hereby we avoid to run JS multiple times.\n    if (element && !element.dataset.encodedtable) {\n        element.dataset.encodedtable = encodedtable;\n    } else {\n        // eslint-disable-next-line no-console\n        console.log('wb didnnt find element aborted', identifier);\n        return;\n    }\n\n    // We only make this callback during init if there is the spinner running.\n    // We don't want to run all of this if we don't use lazyloading.\n    let spinner = document.querySelector(\"#\" + identifier + 'spinner');\n\n    if ((spinner !== null) && !isHidden(spinner)) {\n\n        var observer = new MutationObserver(function() {\n            if (!isHidden(element)) {\n                this.disconnect();\n\n                callback(idstring, encodedtable);\n            }\n        });\n\n        const hiddenElement = returnHiddenElement(element);\n\n        if (hiddenElement !== null) {\n\n            observer.observe(hiddenElement, {attributes: true});\n        } else {\n            callback(idstring, encodedtable);\n        }\n\n    } else {\n\n        // This is what we do when we didn't lazyload.\n        replaceLinksInFrag(idstring, encodedtable, element, null);\n\n        const selector = \".wunderbyte_table_container_\" + idstring;\n        initializeCheckboxes(selector, idstring, encodedtable);\n        initializeSearch(selector, idstring, encodedtable);\n        initializeSort(selector, idstring, encodedtable);\n        initializeReload(selector, idstring, encodedtable);\n\n        // Check to see if scrolling near bottom of page; load more photos\n        // This shoiuld only be added once.\n\n        // As this can only be here once per table, we mark the table.\n        addScrollFunctionality(idstring, encodedtable, element);\n\n    }\n}\n\n/**\n * Return the next scrollable element.\n * @param {*} node\n * @returns {*} node\n */\nfunction getScrollParent(node) {\n    if (node === null) {\n      return null;\n    }\n\n    if (node.scrollHeight > node.clientHeight) {\n      return node;\n    } else {\n      return getScrollParent(node.parentNode);\n    }\n  }\n\n/**\n * Function to check visibility of element.\n * @param {*} el\n * @returns {boolean}\n */\n export const isHidden = (el) => {\n    var style = window.getComputedStyle(el);\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\n};\n\n/**\n * Reloads the rendered table and sets it to the div with the right identifier.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {null|int} page\n * @param {null|string} tsort\n * @param {null|string} thide\n * @param {null|string} tshow\n * @param {null|int} tdir\n * @param {null|int} treset\n * @param {null|string} filterobjects\n * @param {null|string} searchtext\n * @param {null|bool} replacerow\n */\nexport const callLoadData = (\n    idstring,\n    encodedtable,\n    page = null,\n    tsort = null,\n    thide = null,\n    tshow = null,\n    tdir = null,\n    treset = null,\n    filterobjects = null,\n    searchtext = null,\n    replacerow = false) => {\n\n    if (loadings[idstring]) {\n        return;\n    }\n\n    // We reset scrollpage with 0 when we come from the filter.\n    if (page !== null) {\n        scrollpages[idstring] = page;\n    }\n\n    // We always have to see if we need to apply a filter. Reload might come from scroll, but filter has to be applied nevertheless.\n    if (filterobjects === null) {\n        filterobjects = getFilterOjects(idstring);\n    }\n    // We always have to see if we need to apply a serachtextfilter.\n    if (searchtext === null) {\n        searchtext = getSearchInput(idstring);\n    }\n    // We always have to see if we need to apply a sortorder.\n    if (tsort === null) {\n        tsort = getSortSelection(idstring);\n    }\n\n    let table = document.getElementById('a' + idstring);\n\n    // This is now the individual spinner from the wunderbyte table template.\n    let spinner = document.querySelector('#a' + idstring + 'spinner .spinner-border');\n\n    // If we replace the whole table, we show the spinner. If we only add rows in infinite scroll, we don't.\n    if (scrollpages[idstring] == 0\n            && !replacerow) {\n        if (spinner) {\n            spinner.classList.remove('hidden');\n        }\n        if (table) {\n            table.classList.add('hidden');\n        }\n    }\n\n    loadings[idstring] = true;\n\n    Ajax.call([{\n        methodname: \"local_wunderbyte_table_load_data\",\n        args: {\n            'encodedtable': encodedtable,\n            'page': page,\n            'tsort': tsort,\n            'thide': thide,\n            'tshow': tshow,\n            'tdir': tdir,\n            'treset': treset,\n            'filterobjects': filterobjects,\n            'searchtext': searchtext\n        },\n        done: function(res) {\n\n            let jsonobject = JSON.parse(res.content);\n            let rendertemplate = res.template;\n\n            // We can always expect a wunderbyte table container at this point.\n            // The container will hold wunderbyteTableClass, wunderbyteTableFilter, wunderbyteTableSearch classes.\n            let container = document.querySelector(\".wunderbyte_table_container_\" + idstring);\n            const componentscontainer = container.querySelector(\".wunderbyte_table_components\");\n\n            // If we only increase the scrollpage, we don't need to render everything again.\n            if (replacerow\n                || (scrollpages[idstring] > 0)) {\n\n                // Also, we want to use the table instead of the container template.\n                const rowtemplate = rendertemplate + '_row';\n\n                if (!jsonobject.table.hasOwnProperty('rows')) {\n                    // We set the scrollpage to -1 which means that we don't reload anymore.\n                    scrollpages[idstring] = -1;\n                    loadings[idstring] = false;\n                    return;\n                }\n                let rows = jsonobject.table.rows;\n\n                // We create an array of promises where every line is rendered individually.\n                const promises = rows.map(row => {\n                    Templates.renderForPromise(rowtemplate, row).then(({html, js}) => {\n\n                        if (replacerow) {\n\n                            // We need the id.\n                            const filterobject = JSON.parse(filterobjects);\n                            const rowid = filterobject.id;\n\n                            Templates.replaceNode(\"#a\" + idstring\n                                + \" .rows-container tr[data-id='\" + rowid + \"']\", html, js);\n                        } else {\n                            // Here we add the rendered content to the table div.\n                            Templates.appendNodeContents('#a' + idstring + \" .rows-container\", html, js);\n                        }\n\n                        return true;\n                    }).catch(e => {\n                        // eslint-disable-next-line no-console\n                        console.log(e);\n                    });\n                    return true;\n                });\n\n                if (!tablejss.hasOwnProperty(idstring)) {\n                    // eslint-disable-next-line no-unused-vars\n                    const promise = Templates.renderForPromise(rendertemplate, jsonobject).then(({html, js}) => {\n\n                        tablejss[idstring] = js;\n                        return true;\n                    }).catch(e => {\n                        // eslint-disable-next-line no-console\n                        console.log(e);\n                    });\n\n                    promises.push(promise);\n                }\n\n                // Once all the promises are fullfilled, we set loading to false.\n                Promise.all(promises).then(() => {\n\n                    setTimeout(() => {\n                        // We only added rows, but they might need some js from the table, so we add the table js again.\n                        Templates.appendNodeContents('#a' + idstring, '', tablejss[idstring]);\n\n                    }, 100);\n\n                    loadings[idstring] = false;\n\n                    return;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n\n                return;\n\n            }\n\n            if (!componentscontainer) {\n                // If the componentscontainer is not yet rendered, we render the container. else, only the table.\n                rendertemplate = rendertemplate + '_container';\n            }\n\n            let frag = container.querySelector(\".wunderbyteTableClass\");\n\n            // We render the html with the right template.\n            Templates.renderForPromise(rendertemplate, jsonobject).then(({html, js}) => {\n\n                if (componentscontainer) {\n                    // Now we clean the existing table.\n                    while (frag.firstChild) {\n                        frag.removeChild(frag.lastChild);\n                    }\n\n                    // Here we add the rendered content to the table div.\n                    Templates.appendNodeContents('#a' + idstring, html, js);\n                } else {\n                    // Here we try to render the whole.hro\n                    const parent = container.parentElement;\n                    container.remove();\n                    Templates.appendNodeContents(parent, html, js);\n\n                    container = document.querySelector(\".wunderbyte_table_container_\" + idstring);\n                }\n\n                replaceLinksInFrag(idstring, encodedtable, container, page);\n\n                // When everything is done, we loaded fine.\n                loadings[idstring] = false;\n\n                if (spinner) {\n                    spinner.classList.add('hidden');\n                }\n                if (table) {\n                    table.classList.remove('hidden');\n                }\n\n                // Make sure all elements are working.\n                const selector = \".wunderbyte_table_container_\" + idstring;\n                initializeCheckboxes(selector, idstring, encodedtable);\n                initializeSearch(selector, idstring, encodedtable);\n                initializeSort(selector, idstring, encodedtable);\n\n                const element = container.querySelector('#a' + idstring);\n\n                // This is the place where we are after lazyloading. We check if we need to reinitialize scrolllistener:\n                addScrollFunctionality(idstring, encodedtable, element);\n\n                return true;\n            }).catch(ex => {\n                loadings[idstring] = false;\n                Notification.addNotification({\n                    message: 'failed rendering ' + ex,\n                    type: \"danger\"\n                });\n            });\n        },\n        fail: function(err) {\n            // If we have an error, resetting the table might be enough. we do that.\n            // To avoid a loop, we only do this in special cases.\n            if ((treset != 1)) {\n                callLoadData(idstring, encodedtable, page, null, null, null, null, 1);\n            } else {\n                let node = document.createElement('DIV');\n                let textnode = document.createTextNode(err.message);\n                node.appendChild(textnode);\n                table.appendChild(node);\n                spinner.classList.add('hidden');\n                table.classList.remove('hidden');\n            }\n        }\n    }]);\n};\n\n/**\n * Add the scroll functionality to the right table.\n * @param {*} idstring\n * @param {*} encodedtable\n * @param {*} element\n * @returns {void}\n */\nfunction addScrollFunctionality(idstring, encodedtable, element) {\n\n    // eslint-disable-next-line no-console\n    console.log(\"addScrollFunctionality\");\n\n    if (element.dataset.scrollinitialized) {\n        return;\n    }\n\n    element.dataset.scrollinitialized = true;\n\n    const scrollableelement = getScrollParent(element);\n\n    // eslint-disable-next-line no-console\n    console.log(scrollableelement);\n\n    scrollableelement.addEventListener('scroll', () => {\n\n        if (!scrollingelement.hasOwnProperty(idstring)) {\n            scrollingelement[idstring] = 'scrollElement';\n        } else {\n            if (scrollingelement[idstring] === 'scrollElement') {\n                scrollListener(element, idstring, encodedtable);\n            }\n        }\n    });\n\n    // It's not easy to decide which is the right, so we have to add both.\n    window.addEventListener('scroll', () => {\n\n        if (!scrollingelement.hasOwnProperty(idstring)) {\n            scrollingelement[idstring] = 'window';\n        } else {\n            if (scrollingelement[idstring] === 'window') {\n                scrollListener(element, idstring, encodedtable);\n            }\n        }\n    });\n\n}\n\n/**\n * To be called in the scroll listener.\n * @param {node} element\n * @param {string} idstring\n * @param {string} encodedtable\n * @returns {void}\n */\nfunction scrollListener(element, idstring, encodedtable) {\n    // We only want to scroll, if the element is visible.\n    // So, if we find a hidden element in the parent, we don't scroll.\n    if (returnHiddenElement(element)) {\n        return;\n    }\n\n    const elementtop = element.getBoundingClientRect().top;\n    const elementheight = element.getBoundingClientRect().height;\n    const screenheight = document.body.scrollHeight;\n\n    if (!loadings[idstring] && scrollpages[idstring] >= 0) {\n        if (elementtop + elementheight - screenheight < 0) {\n            scrollpages[idstring] = scrollpages[idstring] + 1;\n            callLoadData(idstring,\n                    encodedtable,\n                    scrollpages[idstring],\n                    null,\n                    null,\n                    null,\n                    null,\n                    null,\n                    null,\n                    null);\n        }\n    }\n}\n\n/**\n * If the element or one of its parents is hidden, we return it. the hiddenn element.\n * Else we return null.\n * @param {node} element\n * @returns {null|node}\n */\nfunction returnHiddenElement(element) {\n    // We look if we find a hidden parent. If not, we load right away.\n    while (element !== null) {\n        if (!isHidden(element)) {\n            element = element.parentElement;\n        } else {\n            return element;\n        }\n    }\n    return null;\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n * @param {int} page\n */\nfunction replaceSortColumnLinks(idstring, encodedtable, frag, page) {\n\n    var arrayOfItems = frag.querySelectorAll(\"th.header a\");\n\n    arrayOfItems.forEach(item => {\n        var sortid = item.getAttribute('data-sortby');\n        var sortorder = item.getAttribute('data-sortorder');\n        var thide = item.getAttribute('data-action') == 'hide' ? item.getAttribute('data-column') : null;\n        var tshow = item.getAttribute('data-action') == 'show' ? item.getAttribute('data-column') : null;\n\n        item.setAttribute('href', '#');\n        item.addEventListener('click', () => {\n            callLoadData(idstring, encodedtable, page, sortid, thide, tshow, sortorder);\n        });\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n * @param {int} page\n */\nfunction replaceResetTableLink(idstring, encodedtable, frag, page) {\n    var arrayOfItems = frag.querySelectorAll(\"div.resettable\");\n\n    if (!arrayOfItems || arrayOfItems.length == 0) {\n        return;\n    }\n    arrayOfItems.forEach(item => {\n        var classofelement = item.getAttribute('class');\n        if (classofelement.indexOf('resettable') >= 0) {\n            let listOfChildren = item.querySelectorAll('a');\n            listOfChildren.forEach(subitem => {\n                subitem.setAttribute('href', '#');\n                subitem.addEventListener('click', () => {\n                    callLoadData(idstring, encodedtable, page, null, null, null, null, 1);\n                });\n            });\n        }\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n */\nfunction replacePaginationLinks(idstring, encodedtable, frag) {\n    var arrayOfPageItems = frag.querySelectorAll(\".page-item\");\n\n    if (!arrayOfPageItems || arrayOfPageItems.length == 0) {\n        return;\n    }\n    arrayOfPageItems.forEach(item => {\n\n        let pageNumber = item.dataset.pagenumber;\n\n        if (pageNumber) {\n            --pageNumber;\n            item.addEventListener('click', () => {\n                callLoadData(idstring, encodedtable, pageNumber);\n            });\n        }\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n */\nfunction replaceDownloadLink(idstring, encodedtable, frag) {\n\n    var arrayOfItems = frag.querySelectorAll(\"form\");\n\n    arrayOfItems.forEach(item => {\n        if (item.tagName == 'FORM') {\n            item.setAttribute('method', 'POST');\n            let newnode = document.createElement('input');\n            newnode.setAttribute('type', 'hidden');\n            newnode.setAttribute('name', 'encodedtable');\n            newnode.setAttribute('value', encodedtable);\n            item.appendChild(newnode);\n        }\n    });\n}\n\n/**\n *\n * @param {*} idstring\n * @param {*} encodedtable\n * @param {*} frag\n * @param {*} page\n */\n function replaceLinksInFrag(idstring, encodedtable, frag, page = null) {\n\n    if (!page) {\n        const activepage = frag.querySelector('li.page-item active');\n        if (activepage) {\n            page = activepage.getAttribute('data-page-number');\n        }\n    }\n\n    replaceDownloadLink(idstring, encodedtable, frag);\n    replaceResetTableLink(idstring, encodedtable, frag, page);\n    replacePaginationLinks(idstring, encodedtable, frag);\n    replaceSortColumnLinks(idstring, encodedtable, frag, page);\n}\n"],"file":"init.min.js"}
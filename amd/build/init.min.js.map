{"version":3,"sources":["../src/init.js"],"names":["init","idstring","checkElement","then","callLoadData","page","tsort","thide","tshow","tdir","treset","table","document","getElementById","spinner","querySelector","classList","toggle","encodedtable","getAttribute","Ajax","call","methodname","args","done","res","frag","createRange","createContextualFragment","content","replaceResetTableLink","replacePaginationLinks","replaceSortColumnLinks","firstChild","removeChild","lastChild","appendChild","fail","alert","arrayOfItems","querySelectorAll","forEach","item","sortid","sortorder","setAttribute","addEventListener","length","classofelement","indexOf","listOfChildren","subitem","arrayOfPageItems","element","url","pageNumber","newurl","URL","urlParams","URLSearchParams","search","get","selector","Promise","resolve","requestAnimationFrame"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\n// import * as Str from 'core/str';\nimport Ajax from 'core/ajax';\n\nexport const init = (idstring) => {\n    // eslint-disable-next-line no-alert\n    // alert('hello' + idstring);\n\n    // let table = document.getElementById(idstring);\n    checkElement('#a' + idstring).then(() => {\n    callLoadData(idstring);\n    });\n};\n\nexport const callLoadData = (\n    idstring,\n    page = null,\n    tsort = null,\n    thide = null,\n    tshow = null,\n    tdir = null,\n    treset = null) => {\n \n    let table = document.getElementById('a' + idstring);\n    let spinner = document.querySelector('#a'+ idstring + 'spinner .spinner-border' );\n    spinner.classList.toggle('hidden');\n    table.classList.toggle('hidden');\n\n    let encodedtable = table.getAttribute('data-encodedtable');\n\n    Ajax.call([{\n        methodname: \"local_wunderbyte_table_load_data\",\n        args: {\n            'encodedtable': encodedtable,\n            'page': page,\n            'tsort': tsort,\n            'thide': thide,\n            'tshow': tshow,\n            'tdir': tdir,\n            'treset': treset\n        },\n        done: function(res) {\n\n            let frag = document.createRange().createContextualFragment(res.content);\n\n            // eslint-disable-next-line no-alert\n            // JSON.stringify(frag));\n\n            // replaceDownloadLink(idstring, frag);\n            replaceResetTableLink(idstring, frag);\n            replacePaginationLinks(idstring, frag);\n            replaceSortColumnLinks(idstring, frag);\n\n            // Template for appending Text to element.\n            // var node = document.createElement(\"DIV\");\n            // var textnode = document.createTextNode(\"This is my text\");\n            // node.appendChild(textnode);\n            let table = document.getElementById('a' + idstring);\n\n            while (table.firstChild) {\n                table.removeChild(table.lastChild);\n            }\n            table.appendChild(frag);\n            spinner.classList.toggle('hidden');\n            table.classList.toggle('hidden');\n        },\n        fail: function() {\n            alert('fail');\n            // spinner.addClass('hidden');\n            //table.removeClass('hidden');\n        }\n    }]);\n};\n\nexport const replaceSortColumnLinks = (idstring, frag) => {\n\n    var arrayOfItems = frag.querySelectorAll(\"th.header a\");\n\n    arrayOfItems.forEach(item => {\n        var sortid = item.getAttribute('data-sortby');\n        var sortorder = item.getAttribute('data-sortorder');\n        var thide = item.getAttribute('data-action') == 'hide' ? item.getAttribute('data-column') : null;\n        var tshow = item.getAttribute('data-action') == 'show' ? item.getAttribute('data-column') : null;\n\n        item.setAttribute('href', '#');\n        item.addEventListener('click', () => {\n            callLoadData(idstring, null, sortid, thide, tshow, sortorder);\n        });\n    });\n};\n\nexport const replaceResetTableLink = (idstring, frag) => {\n    var arrayOfItems = frag.querySelectorAll(\"div.resettable\");\n\n    if (!arrayOfItems || arrayOfItems.length == 0) {\n        return;\n    }\n    arrayOfItems.forEach(item => {\n        var classofelement = item.getAttribute('class');\n        if (classofelement.indexOf('resettable') >= 0) {\n            let listOfChildren = item.querySelectorAll('a');\n            listOfChildren.forEach(subitem => {\n                subitem.setAttribute('href', '#');\n                subitem.addEventListener('click', () => {\n                    callLoadData(idstring, null, null, null, null, null, 1);\n                });\n            });\n        }\n    });\n};\n\nexport const replacePaginationLinks = (idstring, frag) => {\n    var arrayOfPageItems = frag.querySelectorAll(\".page-item\");\n\n    if (!arrayOfPageItems || arrayOfPageItems.length == 0) {\n        return;\n    }\n    arrayOfPageItems.forEach(item => {\n        var element = item.querySelector('a');\n        var url = element.getAttribute(\"href\");\n        var pageNumber;\n        if (url != undefined && url != '#') {\n            let newurl = new URL(url);\n            var urlParams = new URLSearchParams(newurl.search);\n            pageNumber = urlParams.get('page');\n        }\n        element.setAttribute('href', '#');\n        if (pageNumber) {\n            element.addEventListener('click', () => {\n                callLoadData(idstring, pageNumber);\n            });\n        }\n    });\n};\n\nconst checkElement = async selector => {\n    while ( document.querySelector(selector) === null) {\n      await new Promise( resolve =>  requestAnimationFrame(resolve) )\n    }\n    return document.querySelector(selector); \n  };\n\n"],"file":"init.min.js"}
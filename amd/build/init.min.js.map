{"version":3,"sources":["../src/init.js"],"names":["idstring","encodedtable","substring","element","document","getElementById","dataset","callLoadData","loading","scrollpage","tablejs","init","respondToVisibility","callback","identifier","spinner","isHidden","observer","MutationObserver","disconnect","parentElement","observe","attributes","replaceLinksInFrag","scrollinitialized","window","addEventListener","scrollY","innerHeight","scrollHeight","console","log","body","el","style","getComputedStyle","display","visibility","page","tsort","thide","tshow","tdir","treset","filterobjects","searchtext","table","querySelector","classList","remove","add","Ajax","call","methodname","args","done","res","jsonobject","JSON","parse","content","rendertemplate","template","rendercontainer","container","filtercontainer","i","lastIndexOf","rowtemplate","hasOwnProperty","rows","promises","map","row","Templates","renderForPromise","then","html","js","appendNodeContents","catch","e","promise","push","Promise","all","length","setTimeout","frag","firstChild","removeChild","lastChild","parent","ex","Notification","addNotification","message","type","fail","err","node","createElement","textnode","createTextNode","appendChild","replaceSortColumnLinks","arrayOfItems","querySelectorAll","forEach","item","sortid","getAttribute","sortorder","setAttribute","replaceResetTableLink","classofelement","indexOf","listOfChildren","subitem","replacePaginationLinks","arrayOfPageItems","pageNumber","pagenumber","replaceDownloadLink","tagName","newnode","activepage"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\n// import {renderFilter, initializeCheckboxes} from 'local_wunderbyte_table/search';\nimport {initializeCheckboxes, getFilterOjects} from 'local_wunderbyte_table/search';\n\nvar loading = false;\nvar scrollpage = 0;\n\nvar tablejs = null;\n\n/**\n * Gets called from mustache template.\n * @param {string} idstring\n * @param {string} encodedtable\n */\nexport const init = (idstring, encodedtable) => {\n\n    if (idstring && encodedtable) {\n        respondToVisibility(idstring, encodedtable, callLoadData);\n    }\n};\n\n/**\n * React on visibility change.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {function} callback\n */\nfunction respondToVisibility(idstring, encodedtable, callback) {\n\n    const identifier = 'a' + idstring;\n    let element = document.getElementById(identifier);\n\n    // If we find the table element AND if it hasn't yet the encoded table set, we abort this.\n    // Hereby we avoid to run JS multiple times.\n    if (element && !element.dataset.encodedtable) {\n        element.dataset.encodedtable = encodedtable;\n    } else {\n        // If we don't find an element, we abort.\n        return;\n    }\n\n    // We only make this callback during init if there is the spinner running.\n    // We don't want to run all of this if we don't use lazyloading.\n    let spinner = document.getElementById(identifier + 'spinner');\n\n    if ((spinner !== null) && !isHidden(spinner)) {\n        callback(idstring, encodedtable);\n\n        var observer = new MutationObserver(function() {\n            if (!isHidden(element)) {\n                this.disconnect();\n                callback(idstring, encodedtable);\n            }\n        });\n\n        // We look if we find a hidden parent. If not, we load right away.\n        while (element !== null) {\n            if (!isHidden(element)) {\n                element = element.parentElement;\n            } else {\n                observer.observe(element, {attributes: true});\n                return;\n            }\n        }\n    } else {\n        // This is what we do when we didn't lazyload.\n        replaceLinksInFrag(idstring,encodedtable, element, null);\n\n        const selector = \".wunderbyte_table_container_\" + idstring;\n        initializeCheckboxes(selector, idstring, encodedtable);\n    }\n\n    // Check to see if scrolling near bottom of page; load more photos\n    // This shoiuld only be added once.\n\n    // As this can only be here once per table, we mark the table.\n    if (element.dataset.scrollinitialized) {\n        return;\n    }\n    element.dataset.scrollinitialized = true;\n\n    window.addEventListener('scroll', () => {\n\n        if (!loading && scrollpage >= 0) {\n            if (window.scrollY + window.innerHeight >= element.scrollHeight - 100) {\n                // eslint-disable-next-line no-console\n                console.log('load more data', window.scrollY, window.scrollY + window.innerHeight,\n                    document.body.scrollHeight);\n                scrollpage++;\n                // eslint-disable-next-line no-console\n                console.log('call load for scroll', scrollpage);\n                callLoadData(idstring,\n                        encodedtable,\n                        scrollpage,\n                        null,\n                        null,\n                        null,\n                        null,\n                        null,\n                        null,\n                        null);\n            }\n        }\n\n    });\n}\n\n/**\n * Function to reload a wunderbyte table from js.\n * Here we trim the idstring before we pass it to the calldatafunction.\n * @param {*} idstring\n * @param {*} encodedtable\n */\nexport function wbTableReload(idstring, encodedtable = null) {\n\n\n    // We need to trim the first character. We use the a to make sure no number is in first place due to random generation.\n    idstring = idstring.substring(1);\n\n    let element = document.getElementById('a' + idstring);\n\n    if (!element) {\n\n        return;\n    }\n\n    if (!encodedtable) {\n        encodedtable = element.dataset.encodedtable;\n\n        if (!encodedtable) {\n            return;\n        }\n    }\n\n    callLoadData(idstring, encodedtable);\n}\n\n/**\n * Function to check visibility of element.\n * @param {*} el\n * @returns {boolean}\n */\n export const isHidden = (el) => {\n    var style = window.getComputedStyle(el);\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\n};\n\n/**\n * Reloads the rendered table and sets it to the div with the right identifier.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {null|int} page\n * @param {null|string} tsort\n * @param {null|string} thide\n * @param {null|string} tshow\n * @param {null|int} tdir\n * @param {null|int} treset\n * @param {null|string} filterobjects\n * @param {null|string} searchtext\n */\nexport const callLoadData = (\n    idstring,\n    encodedtable,\n    page = null,\n    tsort = null,\n    thide = null,\n    tshow = null,\n    tdir = null,\n    treset = null,\n    filterobjects = null,\n    searchtext = null) => {\n\n    if (loading) {\n        return;\n    }\n\n    // We reset scrollpage with 0 when we come from the filter.\n    if (page !== null) {\n        scrollpage = page;\n    }\n\n    // We always have to see if we need to apply a filter. Reload might come from scroll, but filter has to be applied nevertheless.\n    if (filterobjects === null) {\n        filterobjects = getFilterOjects();\n    }\n\n    let table = document.getElementById('a' + idstring);\n\n    // This is now the individual spinner from the wunderbyte table template.\n    let spinner = document.querySelector('#a' + idstring + 'spinner .spinner-border');\n\n    // If we replace the whole table, we show the spinner. If we only add rows in infinite scroll, we don't.\n    if (scrollpage == 0) {\n        if (spinner) {\n            spinner.classList.remove('hidden');\n        }\n        if (table) {\n            table.classList.add('hidden');\n        }\n    }\n\n    loading = true;\n\n    Ajax.call([{\n        methodname: \"local_wunderbyte_table_load_data\",\n        args: {\n            'encodedtable': encodedtable,\n            'page': page,\n            'tsort': tsort,\n            'thide': thide,\n            'tshow': tshow,\n            'tdir': tdir,\n            'treset': treset,\n            'filterobjects': filterobjects,\n            'searchtext': searchtext\n        },\n        done: function(res) {\n\n            // eslint-disable-next-line no-console\n            console.log(res);\n\n            let jsonobject = JSON.parse(res.content);\n            let rendertemplate = res.template;\n            let rendercontainer = true;\n\n            // We can always expect a wunderbyte table container at this point.\n            // The container will hold wunderbyteTableClass, wunderbyteTableFilter, wunderbyteTableSearch classes.\n            let container = document.querySelector(\".wunderbyte_table_container_\" + idstring);\n            const filtercontainer = container.querySelector(\".wunderbyteTableFilter\");\n\n            // If there is a container, we don't want to render everything again.\n            if (scrollpage > 0) {\n                // Also, we want to use the table instead of the container template.\n                // This is not perfect, but necessary at the moment.\n                const i = rendertemplate.lastIndexOf('/');\n                let rowtemplate = rendertemplate.substring(0, i);\n                rowtemplate += '/row';\n\n                // eslint-disable-next-line no-console\n                console.log(rowtemplate, rendertemplate);\n\n                if (!jsonobject.table.hasOwnProperty('rows')) {\n                    // We set the scrollpage to -1 which means that we don't reload anymore.\n                    scrollpage = -1;\n                    loading = false;\n                    return;\n                }\n                let rows = jsonobject.table.rows;\n\n                // eslint-disable-next-line no-console\n                console.log(rendertemplate, rows);\n\n                // We create an array of promises where every line is rendered individually.\n                const promises = rows.map(row => {\n                    Templates.renderForPromise(rowtemplate, row).then(({html, js}) => {\n                        // Here we add the rendered content to the table div.\n                        Templates.appendNodeContents('#a' + idstring + \" div.rows\", html, js);\n                        return true;\n                    }).catch(e => {\n                        // eslint-disable-next-line no-console\n                        console.log(e);\n                    });\n                });\n\n                if (tablejs === null) {\n                    // eslint-disable-next-line no-unused-vars\n                    const promise = Templates.renderForPromise(rendertemplate, jsonobject).then(({html, js}) => {\n\n                        tablejs = js;\n                        return true;\n                    }).catch(e => {\n                        // eslint-disable-next-line no-console\n                        console.log(e);\n                    });\n\n                    promises.push(promise);\n                }\n\n                // Once all the promises are fullfilled, we set loading to false.\n                Promise.all(promises).then(() => {\n\n                    // eslint-disable-next-line no-console\n                    console.log(promises.length);\n\n                    setTimeout(() => {\n                        // We only added rows, but they might need some js from the table, so we add the table js again.\n                        Templates.appendNodeContents('#a' + idstring, '', tablejs);\n\n                        // eslint-disable-next-line no-console\n                        console.log('just added js to page ' + page + \" \" + rows);\n                    }, 100);\n\n                    loading = false;\n                    return;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n\n                return;\n\n            } else if (filtercontainer) { // If there is a container, we don't want to render everything again.\n                // Also, we want to use the table instead of the container template.\n                // This is not perfect, but necessary at the moment.\n                const i = rendertemplate.lastIndexOf('/');\n                rendertemplate = rendertemplate.substring(0, i);\n                rendertemplate += '/table';\n\n                rendercontainer = false;\n            }\n\n            let frag = container.querySelector(\".wunderbyteTableClass\");\n\n            // We render the html with the right template.\n            Templates.renderForPromise(rendertemplate, jsonobject).then(({html, js}) => {\n\n                if (!rendercontainer) {\n                    // Now we clean the existing table.\n                    while (frag.firstChild) {\n                        frag.removeChild(frag.lastChild);\n                    }\n\n                    // Here we add the rendered content to the table div.\n                    Templates.appendNodeContents('#a' + idstring, html, js);\n                } else {\n                    // Here we try to render the whole\n                    const parent = container.parentElement;\n                    container.remove();\n                    Templates.appendNodeContents(parent, html, js);\n\n                    container = document.querySelector(\".wunderbyte_table_container_\" + idstring);\n                }\n\n                replaceLinksInFrag(idstring,encodedtable, container, page);\n\n                // When everything is done, we loaded fine.\n                loading = false;\n\n                return true;\n            }).catch(ex => {\n                loading = false;\n                Notification.addNotification({\n                    message: 'failed rendering ' + ex,\n                    type: \"danger\"\n                });\n            });\n\n            // renderSearchbox(idstring);\n\n            if (spinner) {\n                spinner.classList.add('hidden');\n            }\n            if (table) {\n                table.classList.remove('hidden');\n            }\n            return true;\n        },\n        fail: function(err) {\n            // If we have an error, resetting the table might be enough. we do that.\n            // To avoid a loop, we only do this in special cases.\n            if ((treset != 1)) {\n                callLoadData(idstring, encodedtable, page, null, null, null, null, 1);\n            } else {\n                let node = document.createElement('DIV');\n                let textnode = document.createTextNode(err.message);\n                node.appendChild(textnode);\n                table.appendChild(node);\n                spinner.classList.add('hidden');\n                table.classList.remove('hidden');\n            }\n        }\n    }]);\n};\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n * @param {int} page\n */\nfunction replaceSortColumnLinks(idstring, encodedtable, frag, page) {\n\n    var arrayOfItems = frag.querySelectorAll(\"th.header a\");\n\n    arrayOfItems.forEach(item => {\n        var sortid = item.getAttribute('data-sortby');\n        var sortorder = item.getAttribute('data-sortorder');\n        var thide = item.getAttribute('data-action') == 'hide' ? item.getAttribute('data-column') : null;\n        var tshow = item.getAttribute('data-action') == 'show' ? item.getAttribute('data-column') : null;\n\n        item.setAttribute('href', '#');\n        item.addEventListener('click', () => {\n            callLoadData(idstring, encodedtable, page, sortid, thide, tshow, sortorder);\n        });\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n * @param {int} page\n */\nfunction replaceResetTableLink(idstring, encodedtable, frag, page) {\n    var arrayOfItems = frag.querySelectorAll(\"div.resettable\");\n\n    if (!arrayOfItems || arrayOfItems.length == 0) {\n        return;\n    }\n    arrayOfItems.forEach(item => {\n        var classofelement = item.getAttribute('class');\n        if (classofelement.indexOf('resettable') >= 0) {\n            let listOfChildren = item.querySelectorAll('a');\n            listOfChildren.forEach(subitem => {\n                subitem.setAttribute('href', '#');\n                subitem.addEventListener('click', () => {\n                    callLoadData(idstring, encodedtable, page, null, null, null, null, 1);\n                });\n            });\n        }\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n */\nfunction replacePaginationLinks(idstring, encodedtable, frag) {\n    var arrayOfPageItems = frag.querySelectorAll(\".page-item\");\n\n    if (!arrayOfPageItems || arrayOfPageItems.length == 0) {\n        return;\n    }\n    arrayOfPageItems.forEach(item => {\n\n        let pageNumber = item.dataset.pagenumber;\n\n        if (pageNumber) {\n            --pageNumber;\n            item.addEventListener('click', () => {\n                callLoadData(idstring, encodedtable, pageNumber);\n            });\n        }\n    });\n}\n\n/**\n * The rendered table has links we can't use. We replace them with eventlisteners and use the callLoadData function.\n * @param {string} idstring\n * @param {string} encodedtable\n * @param {DocumentFragment} frag\n */\nfunction replaceDownloadLink(idstring, encodedtable, frag) {\n\n    var arrayOfItems = frag.querySelectorAll(\"form\");\n\n    arrayOfItems.forEach(item => {\n        if (item.tagName == 'FORM') {\n            item.setAttribute('method', 'POST');\n            let newnode = document.createElement('input');\n            newnode.setAttribute('type', 'hidden');\n            newnode.setAttribute('name', 'encodedtable');\n            newnode.setAttribute('value', encodedtable);\n            item.appendChild(newnode);\n        }\n    });\n}\n\n/**\n *\n * @param {*} idstring\n * @param {*} encodedtable\n * @param {*} page\n */\n function replaceLinksInFrag(idstring, encodedtable, frag, page = null) {\n\n    if (!page) {\n        const activepage = frag.querySelector('li.page-item active');\n        if (activepage) {\n            page = activepage.getAttribute('data-page-number');\n        }\n    }\n\n    replaceDownloadLink(idstring, encodedtable, frag);\n    replaceResetTableLink(idstring, encodedtable, frag, page);\n    replacePaginationLinks(idstring, encodedtable, frag);\n    replaceSortColumnLinks(idstring, encodedtable, frag, page);\n}\n"],"file":"init.min.js"}
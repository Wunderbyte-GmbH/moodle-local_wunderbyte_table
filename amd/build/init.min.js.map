{"version":3,"sources":["../src/init.js"],"names":["init","idstring","callLoadData","page","tsort","thide","tshow","tdir","treset","table","document","getElementById","spinner","encodedtable","getAttribute","Ajax","call","methodname","args","done","res","frag","createRange","createContextualFragment","content","replaceResetTableLink","replacePaginationLinks","replaceSortColumnLinks","firstChild","removeChild","lastChild","appendChild","fail","removeClass","arrayOfItems","querySelectorAll","forEach","item","sortid","sortorder","setAttribute","addEventListener","length","classofelement","indexOf","listOfChildren","subitem","arrayOfPageItems","element","querySelector","url","pageNumber","newurl","URL","urlParams","URLSearchParams","search","get"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\n// import * as Str from 'core/str';\nimport Ajax from 'core/ajax';\n\nexport const init = (idstring) => {\n    // eslint-disable-next-line no-alert\n    // alert('hello' + idstring);\n\n    // let table = document.getElementById(idstring);\n\n    callLoadData(idstring);\n};\n\nexport const callLoadData = (\n    idstring,\n    page = null,\n    tsort = null,\n    thide = null,\n    tshow = null,\n    tdir = null,\n    treset = null) => {\n    // $('#spinner div').removeClass('hidden');\n    // $('#opengamestable').addClass('hidden');\n    // $('#spinner div').removeClass('hidden');\n\n    let table = document.getElementById(idstring);\n    let spinner = document.getElementById(idstring + spinner);\n    let encodedtable = table.getAttribute('data-encodedtable');\n\n    Ajax.call([{\n        methodname: \"local_wunderbyte_table_load_data\",\n        args: {\n            'encodedtable': encodedtable,\n            'page': page,\n            'tsort': tsort,\n            'thide': thide,\n            'tshow': tshow,\n            'tdir': tdir,\n            'treset': treset\n        },\n        done: function(res) {\n\n            let frag = document.createRange().createContextualFragment(res.content);\n\n            // eslint-disable-next-line no-alert\n            // JSON.stringify(frag));\n\n            // replaceDownloadLink(idstring, frag);\n            replaceResetTableLink(idstring, frag);\n            replacePaginationLinks(idstring, frag);\n            replaceSortColumnLinks(idstring, frag);\n\n            // Template for appending Text to element.\n            // var node = document.createElement(\"DIV\");\n            // var textnode = document.createTextNode(\"This is my text\");\n            // node.appendChild(textnode);\n            let table = document.getElementById(idstring);\n\n            while (table.firstChild) {\n                table.removeChild(table.lastChild);\n            }\n            table.appendChild(frag);\n        },\n        fail: function() {\n            // Debug: alert('fail');\n            // spinner.addClass('hidden');\n            table.removeClass('hidden');\n        }\n    }]);\n};\n\nexport const replaceSortColumnLinks = (idstring, frag) => {\n\n    var arrayOfItems = frag.querySelectorAll(\"th.header a\");\n\n    arrayOfItems.forEach(item => {\n        var sortid = item.getAttribute('data-sortby');\n        var sortorder = item.getAttribute('data-sortorder');\n        var thide = item.getAttribute('data-action') == 'hide' ? item.getAttribute('data-column') : null;\n        var tshow = item.getAttribute('data-action') == 'show' ? item.getAttribute('data-column') : null;\n\n        item.setAttribute('href', '#');\n        item.addEventListener('click', () => {\n            callLoadData(idstring, null, sortid, thide, tshow, sortorder);\n        });\n    });\n};\n\nexport const replaceResetTableLink = (idstring, frag) => {\n    var arrayOfItems = frag.querySelectorAll(\"div.resettable\");\n\n    if (!arrayOfItems || arrayOfItems.length == 0) {\n        return;\n    }\n    arrayOfItems.forEach(item => {\n        var classofelement = item.getAttribute('class');\n        if (classofelement.indexOf('resettable') >= 0) {\n            let listOfChildren = item.querySelectorAll('a');\n            listOfChildren.forEach(subitem => {\n                subitem.setAttribute('href', '#');\n                subitem.addEventListener('click', () => {\n                    callLoadData(idstring, null, null, null, null, null, 1);\n                });\n            });\n        }\n    });\n};\n\nexport const replacePaginationLinks = (idstring, frag) => {\n    var arrayOfPageItems = frag.querySelectorAll(\".page-item\");\n\n    if (!arrayOfPageItems || arrayOfPageItems.length == 0) {\n        return;\n    }\n    arrayOfPageItems.forEach(item => {\n        var element = item.querySelector('a');\n        var url = element.getAttribute(\"href\");\n        var pageNumber;\n        if (url != undefined && url != '#') {\n            let newurl = new URL(url);\n            var urlParams = new URLSearchParams(newurl.search);\n            pageNumber = urlParams.get('page');\n        }\n        element.setAttribute('href', '#');\n        if (pageNumber) {\n            element.addEventListener('click', () => {\n                callLoadData(idstring, pageNumber);\n            });\n        }\n    });\n};"],"file":"init.min.js"}
{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport {callLoadData} from 'local_wunderbyte_table/init';\n\nvar checked = {};\nvar categories = [];\nvar allElements = [];\nvar elementToHideSelector = '';\nvar listContainerSelector = '';\nvar elementToSearchSelector = '';\n\nvar idstring = '';\nvar encodedtable = '';\n\n/**\n * Store some params globally.\n * @param {string} listContainer\n * @param {string} elementToHide\n * @param {string} elementToSearch\n */\nexport const init = (listContainer, elementToHide, elementToSearch) => {\n\n    // eslint-disable-next-line no-console\n    console.log(listContainer, \"elementToHide: \", elementToHide, \"elementToSearch:\", elementToSearch);\n\n    elementToHideSelector = elementToHide;\n    listContainerSelector = listContainer;\n    elementToSearchSelector = elementToSearch;\n\n};\n\nexport const searchInput = (inputElement, elementToHide, elementToSearch) => {\n    let filter, li, a, i, txtValue;\n\n    filter = inputElement.value.toUpperCase();\n\n    li = document.querySelectorAll(elementToHide);\n\n    for (i = 0; i < li.length; i++) {\n        if (elementToSearch) {\n            a = li[i].querySelector(elementToSearch);\n        } else {\n            a = li[i];\n        }\n\n        txtValue = a.textContent || a.innerText;\n\n        if (txtValue.toUpperCase().indexOf(filter) > -1) {\n            li[i].style.display = \"\";\n        } else {\n            li[i].style.display = \"none\";\n        }\n    }\n};\n\n\n/**\n * Eventhandler\n *\n * @param {*} e - event\n */\n export const toggleCheckbox = (e) => {\n\n    // eslint-disable-next-line no-console\n    console.log('checked', e.target.name);\n    getChecked(e.target.name);\n\n    // Reload the filtered elements via ajax.\n\n    const filterobjects = getFilterOjects();\n\n    // eslint-disable-next-line no-console\n    console.log('reload from filter ', filterobjects);\n\n    callLoadData(idstring,\n    encodedtable,\n    0,\n    null,\n    null,\n    null,\n    null,\n    null,\n    filterobjects);\n\n    setVisibility();\n  };\n\n  /**\n   * Check which Checkboxes are selected inside a group.\n   *\n   * @param {*} name of Element group\n   */\n  export const getChecked = (name) => {\n    checked[name] = Array.from(\n      document.querySelectorAll(\"input[name=\" + name + \"]:checked\")\n    ).map(function(el) {\n      return el.value;\n    });\n  };\n\n  /**\n   * Compares checked boxes with classes of Elements and shows or hides them.\n   */\n  export const setVisibility = () => {\n    allElements.forEach(function(el) {\n      let display = true;\n      categories.forEach(function(c) {\n\n        let intersection = checked[c].length\n          ? Array.from(Object.values(el.dataset)).filter((x) =>\n              checked[c].includes(x)\n            ).length\n          : true;\n        if (!intersection) {\n          display = false;\n          return;\n        }\n      });\n      if (display) {\n        el.style.display = \"block\";\n      } else {\n        el.style.display = \"none\";\n      }\n    });\n  };\n\n\n  /**\n   * Render the checkboxes for the filer.\n   * @param {string} filterjson\n   * @param {string} idstringvar\n   * @param {string} encodedtable\n   */\n  export const renderFilter = (filterjson, idstringvar, encodedtable) => {\n\n    // We render the filter only once, so if we find it already, we don't render it.\n\n    // eslint-disable-next-line no-console\n    console.log(idstringvar);\n\n    idstring = idstringvar;\n\n    const selector = \".wunderbyte_table_container_\" + idstring;\n    const container = document.querySelector(selector);\n    const filtercontainer = container.querySelector(\".wunderbyteTableFilter\");\n\n    if (filtercontainer) {\n      return;\n    }\n\n    Templates.renderForPromise('local_wunderbyte_table/filter', filterjson).then(({html}) => {\n\n        // eslint-disable-next-line no-console\n        console.log(\"encodedtable: \", encodedtable);\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeCheckboxes(selector, idstring, encodedtable);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n/**\n   * Render the checkboxes for the filer.\n   * @param {string} idstring\n   */\n export const renderSearchbox = (idstring) => {\n\n    const selector = \".wunderbyte_table_container_\" + idstring;\n    const container = document.querySelector(selector);\n    const searchcontainer = container.querySelector(\"input.search\");\n\n    if (searchcontainer) {\n      return;\n    }\n\n    Templates.renderForPromise('local_wunderbyte_table/search', []).then(({html}) => {\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeSearch(selector);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n\n/**\n * Function to initialize the search after rendering the searchbox.\n */\n export function initializeSearch() {\n\n    const inputElement = document.querySelector(listContainerSelector + ' input.search');\n\n    if (!inputElement) {\n        return;\n    }\n\n    if (!inputElement.dataset.initialized) {\n      inputElement.addEventListener('keyup', () => {\n\n        searchInput(inputElement, elementToHideSelector, elementToSearchSelector);\n\n        inputElement.dataset.initialized = true;\n      });\n    }\n}\n\n/**\n * Returns json of active filters as json.\n * @returns string\n * @returns string\n */\nexport function getFilterOjects() {\n\n  return JSON.stringify(checked);\n}\n\n/**\n * Initialize Checkboxes.\n * @param {string} selector\n * @param {string} idstringvar\n * @param {string} encodedtablevar\n */\nexport function initializeCheckboxes(selector, idstringvar, encodedtablevar) {\n\n    encodedtable = encodedtablevar;\n    idstring = idstringvar;\n\n    const filterContainer = document.querySelector(selector + \" .wunderbyteTableFilter\");\n\n    if (filterContainer.dataset.initialized) {\n      return;\n    }\n\n    const allCheckboxes = filterContainer.querySelectorAll(\"input[type=checkbox]\");\n\n    // Error gets spinner\n    allElements = document.querySelectorAll(selector + \" \" + elementToHideSelector);\n\n    if (!allCheckboxes) {\n        return;\n    }\n\n    filterContainer.querySelectorAll(\".form-group\").forEach(e => {\n        categories.push(e.getAttribute(\"name\"));\n        getChecked(e.getAttribute(\"name\"));\n    });\n\n    allCheckboxes.forEach(el => {\n        el.addEventListener(\"change\", toggleCheckbox);\n    });\n\n    filterContainer.dataset.initialized = true;\n}\n"],"names":["checked","categories","allElements","elementToHideSelector","listContainerSelector","elementToSearchSelector","idstring","encodedtable","listContainer","elementToHide","elementToSearch","console","log","searchInput","inputElement","filter","li","a","i","txtValue","value","toUpperCase","document","querySelectorAll","length","querySelector","textContent","innerText","indexOf","style","display","toggleCheckbox","e","target","name","getChecked","filterobjects","getFilterOjects","setVisibility","Array","from","map","el","forEach","c","Object","values","dataset","x","includes","filterjson","idstringvar","selector","container","renderForPromise","then","_ref","html","insertAdjacentHTML","initializeCheckboxes","catch","initializeSearch","initialized","addEventListener","JSON","stringify","encodedtablevar","filterContainer","allCheckboxes","push","getAttribute","_ref2"],"mappings":"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"}
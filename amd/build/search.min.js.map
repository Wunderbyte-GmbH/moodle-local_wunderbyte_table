{"version":3,"sources":["../src/search.js"],"names":["checked","categories","allElements","elementToHideSelector","listContainerSelector","elementToSearchSelector","idstring","encodedtable","init","listContainer","elementToHide","elementToSearch","console","log","searchInput","inputElement","filter","li","a","i","txtValue","value","toUpperCase","document","querySelectorAll","length","querySelector","textContent","innerText","indexOf","style","display","toggleCheckbox","e","target","name","getChecked","filterobjects","getFilterOjects","setVisibility","Array","from","map","el","forEach","c","intersection","Object","values","dataset","x","includes","renderFilter","filterjson","idstringvar","selector","container","filtercontainer","Templates","renderForPromise","then","html","insertAdjacentHTML","initializeCheckboxes","catch","renderSearchbox","searchcontainer","initializeSearch","initialized","addEventListener","JSON","stringify","encodedtablevar","filterContainer","allCheckboxes","push","getAttribute"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport {callLoadData} from 'local_wunderbyte_table/init';\n\nvar checked = {};\nvar categories = [];\nvar allElements = [];\nvar elementToHideSelector = '';\nvar listContainerSelector = '';\nvar elementToSearchSelector = '';\n\nvar idstring = '';\nvar encodedtable = '';\n\n/**\n * Store some params globally.\n * @param {string} listContainer\n * @param {string} elementToHide\n * @param {string} elementToSearch\n */\nexport const init = (listContainer, elementToHide, elementToSearch) => {\n\n    // eslint-disable-next-line no-console\n    console.log(listContainer, \"elementToHide: \", elementToHide, \"elementToSearch:\", elementToSearch);\n\n    elementToHideSelector = elementToHide;\n    listContainerSelector = listContainer;\n    elementToSearchSelector = elementToSearch;\n\n};\n\nexport const searchInput = (inputElement, elementToHide, elementToSearch) => {\n    let filter, li, a, i, txtValue;\n\n    filter = inputElement.value.toUpperCase();\n\n    li = document.querySelectorAll(elementToHide);\n\n    for (i = 0; i < li.length; i++) {\n        if (elementToSearch) {\n            a = li[i].querySelector(elementToSearch);\n        } else {\n            a = li[i];\n        }\n\n        txtValue = a.textContent || a.innerText;\n\n        if (txtValue.toUpperCase().indexOf(filter) > -1) {\n            li[i].style.display = \"\";\n        } else {\n            li[i].style.display = \"none\";\n        }\n    }\n};\n\n\n/**\n * Eventhandler\n *\n * @param {*} e - event\n */\n export const toggleCheckbox = (e) => {\n\n    // eslint-disable-next-line no-console\n    console.log('checked', e.target.name);\n    getChecked(e.target.name);\n\n    // Reload the filtered elements via ajax.\n\n    const filterobjects = getFilterOjects();\n\n    // eslint-disable-next-line no-console\n    console.log('reload from filter ', filterobjects);\n\n    callLoadData(idstring,\n    encodedtable,\n    0,\n    null,\n    null,\n    null,\n    null,\n    null,\n    filterobjects);\n\n    setVisibility();\n  };\n\n  /**\n   * Check which Checkboxes are selected inside a group.\n   *\n   * @param {*} name of Element group\n   */\n  export const getChecked = (name) => {\n    checked[name] = Array.from(\n      document.querySelectorAll(\"input[name=\" + name + \"]:checked\")\n    ).map(function(el) {\n      return el.value;\n    });\n  };\n\n  /**\n   * Compares checked boxes with classes of Elements and shows or hides them.\n   */\n  export const setVisibility = () => {\n    allElements.forEach(function(el) {\n      let display = true;\n      categories.forEach(function(c) {\n\n        let intersection = checked[c].length\n          ? Array.from(Object.values(el.dataset)).filter((x) =>\n              checked[c].includes(x)\n            ).length\n          : true;\n        if (!intersection) {\n          display = false;\n          return;\n        }\n      });\n      if (display) {\n        el.style.display = \"block\";\n      } else {\n        el.style.display = \"none\";\n      }\n    });\n  };\n\n\n  /**\n   * Render the checkboxes for the filer.\n   * @param {string} filterjson\n   * @param {string} idstringvar\n   * @param {string} encodedtable\n   */\n  export const renderFilter = (filterjson, idstringvar, encodedtable) => {\n\n    // We render the filter only once, so if we find it already, we don't render it.\n\n    // eslint-disable-next-line no-console\n    console.log(idstringvar);\n\n    idstring = idstringvar;\n\n    const selector = \".wunderbyte_table_container_\" + idstring;\n    const container = document.querySelector(selector);\n    const filtercontainer = container.querySelector(\".wunderbyteTableFilter\");\n\n    if (filtercontainer) {\n      return;\n    }\n\n    Templates.renderForPromise('local_wunderbyte_table/filter', filterjson).then(({html}) => {\n\n        // eslint-disable-next-line no-console\n        console.log(\"encodedtable: \", encodedtable);\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeCheckboxes(selector, idstring, encodedtable);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n/**\n   * Render the checkboxes for the filer.\n   * @param {string} idstring\n   */\n export const renderSearchbox = (idstring) => {\n\n    const selector = \".wunderbyte_table_container_\" + idstring;\n    const container = document.querySelector(selector);\n    const searchcontainer = container.querySelector(\"input.search\");\n\n    if (searchcontainer) {\n      return;\n    }\n\n    Templates.renderForPromise('local_wunderbyte_table/search', []).then(({html}) => {\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeSearch(selector);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n\n/**\n * Function to initialize the search after rendering the searchbox.\n */\n export function initializeSearch() {\n\n    const inputElement = document.querySelector(listContainerSelector + ' input.search');\n\n    if (!inputElement) {\n        return;\n    }\n\n    if (!inputElement.dataset.initialized) {\n      inputElement.addEventListener('keyup', () => {\n\n        searchInput(inputElement, elementToHideSelector, elementToSearchSelector);\n\n        inputElement.dataset.initialized = true;\n      });\n    }\n}\n\n/**\n * Returns json of active filters as json.\n * @returns string\n * @returns string\n */\nexport function getFilterOjects() {\n\n  return JSON.stringify(checked);\n}\n\n/**\n * Initialize Checkboxes.\n * @param {string} selector\n * @param {string} idstringvar\n * @param {string} encodedtablevar\n */\nexport function initializeCheckboxes(selector, idstringvar, encodedtablevar) {\n\n    encodedtable = encodedtablevar;\n    idstring = idstringvar;\n\n    const filterContainer = document.querySelector(selector + \" .wunderbyteTableFilter\");\n\n    if (filterContainer.dataset.initialized) {\n      return;\n    }\n\n    const allCheckboxes = filterContainer.querySelectorAll(\"input[type=checkbox]\");\n\n    // Error gets spinner\n    allElements = document.querySelectorAll(selector + \" \" + elementToHideSelector);\n\n    if (!allCheckboxes) {\n        return;\n    }\n\n    filterContainer.querySelectorAll(\".form-group\").forEach(e => {\n        categories.push(e.getAttribute(\"name\"));\n        getChecked(e.getAttribute(\"name\"));\n    });\n\n    allCheckboxes.forEach(el => {\n        el.addEventListener(\"change\", toggleCheckbox);\n    });\n\n    filterContainer.dataset.initialized = true;\n}\n"],"file":"search.min.js"}
{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\n\nvar checked = {};\nvar categories = [];\nvar allElements = [];\nvar elementToHideSelector = '';\nvar listContainerSelector = '';\nvar elementToSearchSelector = '';\n\n\n/**\n * Store some params globally.\n * @param {string} listContainer\n * @param {string} elementToHide\n * @param {string} elementToSearch\n */\nexport const init = (listContainer, elementToHide, elementToSearch) => {\n\n    // eslint-disable-next-line no-console\n    console.log(listContainerSelector, elementToHide, elementToSearch);\n\n    elementToHideSelector = elementToHide;\n    listContainerSelector = listContainer;\n    elementToSearchSelector = elementToSearch;\n\n};\n\nexport const searchInput = (inputElement, elementToHide, elementToSearch) => {\n    let filter, li, a, i, txtValue;\n\n    filter = inputElement.value.toUpperCase();\n\n    // eslint-disable-next-line no-console\n    console.log(filter);\n\n    li = document.querySelectorAll(elementToHide);\n\n    // eslint-disable-next-line no-console\n    console.log(li);\n\n    for (i = 0; i < li.length; i++) {\n        if (elementToSearch) {\n            a = li[i].querySelector(elementToSearch);\n        } else {\n            a = li[i];\n        }\n\n        txtValue = a.textContent || a.innerText;\n\n        // eslint-disable-next-line no-console\n        console.log(txtValue);\n\n        if (txtValue.toUpperCase().indexOf(filter) > -1) {\n            li[i].style.display = \"\";\n        } else {\n            li[i].style.display = \"none\";\n        }\n    }\n};\n\n\n/**\n * Eventhandler\n *\n * @param {*} e - event\n */\n export const toggleCheckbox = (e) => {\n    getChecked(e.target.name);\n    setVisibility();\n  };\n\n  /**\n   * Check which Checkboxes are selected inside a group.\n   *\n   * @param {*} name of Element group\n   */\n  export const getChecked = (name) => {\n    checked[name] = Array.from(\n      document.querySelectorAll(\"input[name=\" + name + \"]:checked\")\n    ).map(function(el) {\n      return el.value;\n    });\n\n    // eslint-disable-next-line no-console\n    console.log(\"checked\", checked);\n  };\n\n  /**\n   * Compares checked boxes with classes of Elements and shows or hides them.\n   */\n  export const setVisibility = () => {\n\n    // eslint-disable-next-line no-console\n    console.log(categories);\n    allElements.forEach(function(el) {\n      let display = true;\n      categories.forEach(function(c) {\n        let intersection = checked[c].length\n          ? Array.from(Object.values(el.dataset)).filter((x) =>\n              checked[c].includes(x)\n            ).length\n          : true;\n        if (!intersection) {\n          display = false;\n          return;\n        }\n      });\n      if (display) {\n        el.style.display = \"block\";\n      } else {\n        el.style.display = \"none\";\n      }\n    });\n  };\n\n\n  /**\n   * Render the checkboxes for the filer.\n   * @param {string} filterjson\n   * @param {string} idstring\n   */\n  export const renderFilter = (filterjson, idstring) => {\n\n    // eslint-disable-next-line no-console\n    console.log('filterjson', filterjson);\n\n    Templates.renderForPromise('local_wunderbyte_table/filter', filterjson).then(({html}) => {\n\n        // eslint-disable-next-line no-console\n        console.log('renderFilter', html);\n        const selector = \".wunderbyte_table_container_\" + idstring;\n\n        // eslint-disable-next-line no-console\n        console.log('selector', selector);\n\n        const container = document.querySelector(selector);\n\n        // eslint-disable-next-line no-console\n        console.log(container);\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeCheckboxes(selector);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n/**\n   * Render the checkboxes for the filer.\n   * @param {string} idstring\n   */\n export const renderSearchbox = (idstring) => {\n\n\n    Templates.renderForPromise('local_wunderbyte_table/search').then(({html}) => {\n\n        // eslint-disable-next-line no-console\n        console.log('renderSearchbox', html);\n        const selector = \".wunderbyte_table_container_\" + idstring;\n\n        // eslint-disable-next-line no-console\n        console.log('selector', selector);\n\n        const container = document.querySelector(selector);\n\n        // eslint-disable-next-line no-console\n        console.log(container);\n\n        container.insertAdjacentHTML('afterbegin', html);\n\n        initializeSearch(selector);\n\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};\n\n\n/**\n * Function to initialize the search after rendering the searchbox.\n * @returns\n */\n function initializeSearch() {\n\n    const inputElement = document.querySelector(listContainerSelector + ' input.search');\n\n    if (!inputElement) {\n        return;\n    }\n\n    inputElement.addEventListener('keyup', () => {\n\n        searchInput(inputElement, elementToHideSelector, elementToSearchSelector);\n    });\n}\n\n/**\n * Initialize Checkboxes.\n * @param {string} selector\n * @returns\n */\nfunction initializeCheckboxes(selector) {\n\n    // eslint-disable-next-line no-console\n    console.log('initializeCheckboxes ');\n    // eslint-disable-next-line no-console\n    console.log(selector + \" \" + elementToHideSelector);\n    const listContainer = document.querySelector(selector);\n\n    const allCheckboxes = listContainer.querySelectorAll(\"input[type=checkbox]\");\n\n    // Error gets spinner\n    allElements = document.querySelectorAll(selector + \" \" + elementToHideSelector);\n\n    if (!allCheckboxes) {\n        return;\n    }\n\n    // eslint-disable-next-line no-console\n    console.log('allCheckboxes ', allCheckboxes);\n\n    listContainer.querySelectorAll(\".form-group\").forEach(e => {\n        categories.push(e.getAttribute(\"name\"));\n        getChecked(e.getAttribute(\"name\"));\n    });\n\n    allCheckboxes.forEach(el => {\n        el.addEventListener(\"change\", toggleCheckbox);\n    });\n    // eslint-disable-next-line no-console\n    console.log(allElements);\n}\n"],"names":["checked","categories","allElements","elementToHideSelector","listContainerSelector","elementToSearchSelector","listContainer","elementToHide","elementToSearch","console","log","searchInput","inputElement","filter","li","a","i","txtValue","value","toUpperCase","document","querySelectorAll","length","querySelector","textContent","innerText","indexOf","style","display","toggleCheckbox","e","getChecked","target","name","setVisibility","Array","from","map","el","forEach","c","Object","values","dataset","x","includes","filterjson","idstring","renderForPromise","then","_ref","html","selector","container","insertAdjacentHTML","allCheckboxes","push","getAttribute","addEventListener","initializeCheckboxes","catch","_ref2","initializeSearch"],"mappings":";;;;;2RAwBIA,QAAU,GACVC,WAAa,GACbC,YAAc,GACdC,sBAAwB,GACxBC,sBAAwB,GACxBC,wBAA0B,iBASV,CAACC,cAAeC,cAAeC,mBAG/CC,QAAQC,IAAIN,sBAAuBG,cAAeC,iBAElDL,sBAAwBI,cACxBH,sBAAwBE,cACxBD,wBAA0BG,uBAIjBG,YAAc,CAACC,aAAcL,cAAeC,uBACjDK,OAAQC,GAAIC,EAAGC,EAAGC,aAEtBJ,OAASD,aAAaM,MAAMC,cAG5BV,QAAQC,IAAIG,QAEZC,GAAKM,SAASC,iBAAiBd,eAG/BE,QAAQC,IAAII,IAEPE,EAAI,EAAGA,EAAIF,GAAGQ,OAAQN,IAEnBD,EADAP,gBACIM,GAAGE,GAAGO,cAAcf,iBAEpBM,GAAGE,GAGXC,SAAWF,EAAES,aAAeT,EAAEU,UAG9BhB,QAAQC,IAAIO,UAERA,SAASE,cAAcO,QAAQb,SAAW,EAC1CC,GAAGE,GAAGW,MAAMC,QAAU,GAEtBd,GAAGE,GAAGW,MAAMC,QAAU,+CAWpBC,eAAkBC,IAC5BC,WAAWD,EAAEE,OAAOC,MACpBC,8DAQWH,WAAcE,OACzBjC,QAAQiC,MAAQE,MAAMC,KACpBhB,SAASC,iBAAiB,cAAgBY,KAAO,cACjDI,KAAI,SAASC,WACNA,GAAGpB,SAIZT,QAAQC,IAAI,UAAWV,+CAMZkC,cAAgB,KAG3BzB,QAAQC,IAAIT,YACZC,YAAYqC,SAAQ,SAASD,QACvBV,SAAU,EACd3B,WAAWsC,SAAQ,SAASC,IACPxC,QAAQwC,GAAGlB,QAC1Ba,MAAMC,KAAKK,OAAOC,OAAOJ,GAAGK,UAAU9B,QAAQ+B,GAC5C5C,QAAQwC,GAAGK,SAASD,KACpBtB,SAGJM,SAAU,MAKZU,GAAGX,MAAMC,QADPA,QACiB,QAEA,sEAWG,CAACkB,WAAYC,YAGvCtC,QAAQC,IAAI,aAAcoC,+BAEhBE,iBAAiB,gCAAiCF,YAAYG,MAAKC,WAACC,KAACA,WAG3E1C,QAAQC,IAAI,eAAgByC,YACtBC,SAAW,+BAAiCL,SAGlDtC,QAAQC,IAAI,WAAY0C,gBAElBC,UAAYjC,SAASG,cAAc6B,UAGzC3C,QAAQC,IAAI2C,WAEZA,UAAUC,mBAAmB,aAAcH,eAmErBC,UAG1B3C,QAAQC,IAAI,yBAEZD,QAAQC,IAAI0C,SAAW,IAAMjD,6BACvBG,cAAgBc,SAASG,cAAc6B,UAEvCG,cAAgBjD,cAAce,iBAAiB,2BAGrDnB,YAAckB,SAASC,iBAAiB+B,SAAW,IAAMjD,wBAEpDoD,qBAKL9C,QAAQC,IAAI,iBAAkB6C,eAE9BjD,cAAce,iBAAiB,eAAekB,SAAQT,IAClD7B,WAAWuD,KAAK1B,EAAE2B,aAAa,SAC/B1B,WAAWD,EAAE2B,aAAa,YAG9BF,cAAchB,SAAQD,KAClBA,GAAGoB,iBAAiB,SAAU7B,mBAGlCpB,QAAQC,IAAIR,aA9FRyD,CAAqBP,aAGtBQ,OAAM9B,IAELrB,QAAQC,IAAIoB,gCAQaiB,8BAGnBC,iBAAiB,iCAAiCC,MAAKY,YAACV,KAACA,YAG/D1C,QAAQC,IAAI,kBAAmByC,YACzBC,SAAW,+BAAiCL,SAGlDtC,QAAQC,IAAI,WAAY0C,gBAElBC,UAAYjC,SAASG,cAAc6B,UAGzC3C,QAAQC,IAAI2C,WAEZA,UAAUC,mBAAmB,aAAcH,uBAkBzCvC,aAAeQ,SAASG,cAAcnB,sBAAwB,qBAE/DQ,oBAILA,aAAa8C,iBAAiB,SAAS,KAEnC/C,YAAYC,aAAcT,sBAAuBE,4BAxBjDyD,MAGDF,OAAM9B,IAELrB,QAAQC,IAAIoB"}
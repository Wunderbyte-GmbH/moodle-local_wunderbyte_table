{"version":3,"file":"hide.min.js","sources":["../src/hide.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {callLoadData} from 'local_wunderbyte_table/init';\nimport {getFilterOjects} from 'local_wunderbyte_table/filter';\nimport {getSearchInput} from 'local_wunderbyte_table/search';\n\n/**\n * Function to initialize the search after rendering the searchbox.\n * @param {*} listContainer\n * @param {*} idstring\n * @param {*} encodedtable\n * @returns {void}\n */\n export function initializeHide(listContainer, idstring, encodedtable) {\n\n    // eslint-disable-next-line no-console\n    console.log('init hide');\n\n    initializeHideColumns(listContainer, idstring, encodedtable);\n}\n\n/**\n * Initialize Hide Columns in list table.\n * @param {*} listContainer\n * @param {*} idstring\n * @param {*} encodedtable\n */\nexport function initializeHideColumns(listContainer, idstring, encodedtable) {\n\n  const container = document.querySelector(listContainer);\n\n  const sortColumnHeaders = container.querySelectorAll('th .wb-table-column-hide');\n\n  // Add the listeners to column headers.\n  sortColumnHeaders.forEach(element => {\n    if (element.dataset.initialized) {\n      return;\n    }\n    element.dataset.initialized = true;\n\n    element.addEventListener('click', () => {\n      // eslint-disable-next-line no-console\n      console.log('click hide column', element);\n\n      let columnname = null;\n\n      if (element.dataset && element.dataset.columnname) {\n        columnname = element.dataset.columnname;\n      }\n      if (!columnname) {\n        columnname = element.parentElement.dataset.columnname;\n      }\n\n      // eslint-disable-next-line no-console\n      console.log(columnname);\n      callSortAjax(columnname, idstring, encodedtable);\n    });\n  });\n}\n\n/**\n * Execture the two possible sort Ajax calls as reaction on the triggered event.\n * @param {*} event\n * @param {*} idstring\n * @param {*} encodedtable\n */\nfunction callSortAjax(event, idstring, encodedtable) {\n\n  let sortcolumn = null;\n  let sortorder = null;\n  let reset = null;\n\n  const container = document.querySelector(\".wunderbyte_table_container_\" + idstring);\n  const sortColumnElement = container.querySelector('select.sortcolumn');\n\n  let sortOrderElement = container.querySelector(\"a.changesortorder i\");\n  let className = null;\n\n  if (typeof event === 'string') {\n    // We are sure that we clicked on a column header.\n    sortOrderElement = container.querySelector('th.wb-table-column.' + event);\n  }\n\n  className = sortOrderElement.className;\n\n\n  // If we get an event, we are in the sortcolum mode.\n  if (event !== null) {\n\n    if (typeof event === 'string') {\n      // We have gotten the column directly as string.\n      sortcolumn = event;\n    } else {\n      sortcolumn = event.target.value;\n    }\n\n    // We reset only on changed sortcolumn, not on order.\n    reset = 1;\n\n    if (!sortcolumn) {\n      return;\n    }\n\n    // Get the sortorder by the icon and apply it.\n    if (className.includes('asc')) {\n\n      sortorder = 4;\n    } else {\n\n      sortorder = 3;\n    }\n\n  } else {\n    // Else, we are in the sortorder mode.\n    // 3 is ASC, 4 is DESC. We have to find out which is the current mode.\n\n    // Get the sortorder by the icon and change it.\n    if (className.includes('asc')) {\n\n      sortorder = 3;\n      sortOrderElement.className = className.replace('asc', 'desc');\n    } else {\n\n      sortorder = 4;\n      sortOrderElement.className = className.replace('desc', 'asc');\n    }\n\n    // We also need the sortcolumn name to effectuate the change.\n    sortcolumn = sortColumnElement.selectedOptions[0].value;\n  }\n\n   const filterobjects = getFilterOjects(idstring);\n   const searchstring = getSearchInput(idstring);\n\n\n   callLoadData(idstring,\n     encodedtable,\n     0, // We set page to 0 because we need to start the container anew.\n     sortcolumn,\n     null,\n     null,\n     sortorder,\n     reset,\n     filterobjects,\n     searchstring);\n}\n\n/**\n * Function to read the searchstring from the input leement.\n * @param {*} idstring\n * @returns {null|string}\n */\nexport function getSortSelection(idstring) {\n\n  const inputElement = document.querySelector(\".wunderbyte_table_container_\" + idstring + ' select.sort');\n\n  if (!inputElement) {\n    return null;\n  }\n\n  return '';\n}\n"],"names":["initializeHideColumns","listContainer","idstring","encodedtable","document","querySelector","querySelectorAll","forEach","element","dataset","initialized","addEventListener","console","log","columnname","parentElement","event","sortcolumn","sortorder","reset","container","sortColumnElement","sortOrderElement","className","target","value","includes","replace","selectedOptions","filterobjects","searchstring","callSortAjax"],"mappings":"kMA+CgBA,sBAAsBC,cAAeC,SAAUC,cAE3CC,SAASC,cAAcJ,eAELK,iBAAiB,4BAGnCC,SAAQC,UACpBA,QAAQC,QAAQC,cAGpBF,QAAQC,QAAQC,aAAc,EAE9BF,QAAQG,iBAAiB,SAAS,KAEhCC,QAAQC,IAAI,oBAAqBL,aAE7BM,WAAa,KAEbN,QAAQC,SAAWD,QAAQC,QAAQK,aACrCA,WAAaN,QAAQC,QAAQK,YAE1BA,aACHA,WAAaN,QAAQO,cAAcN,QAAQK,YAI7CF,QAAQC,IAAIC,qBAYIE,MAAOd,SAAUC,kBAEjCc,WAAa,KACbC,UAAY,KACZC,MAAQ,WAENC,UAAYhB,SAASC,cAAc,+BAAiCH,UACpEmB,kBAAoBD,UAAUf,cAAc,yBAE9CiB,iBAAmBF,UAAUf,cAAc,uBAC3CkB,UAAY,KAEK,iBAAVP,QAETM,iBAAmBF,UAAUf,cAAc,sBAAwBW,WAGrEO,UAAYD,iBAAiBC,UAIf,OAAVP,MAAgB,IAIhBC,WAFmB,iBAAVD,MAEIA,MAEAA,MAAMQ,OAAOC,MAI5BN,MAAQ,GAEHF,kBAOHC,UAFEK,UAAUG,SAAS,OAET,EAGA,OAQVH,UAAUG,SAAS,QAErBR,UAAY,EACZI,iBAAiBC,UAAYA,UAAUI,QAAQ,MAAO,UAGtDT,UAAY,EACZI,iBAAiBC,UAAYA,UAAUI,QAAQ,OAAQ,QAIzDV,WAAaI,kBAAkBO,gBAAgB,GAAGH,YAG7CI,eAAgB,2BAAgB3B,UAChC4B,cAAe,0BAAe5B,iCAGvBA,SACXC,aACA,EACAc,WACA,KACA,KACAC,UACAC,MACAU,cACAC,cAzFCC,CAAajB,WAAYZ,SAAUC,gHAiGRD,cAEVE,SAASC,cAAc,+BAAiCH,SAAW,uBAG/E,WAGF;;;;;;SAnJuBD,cAAeC,SAAUC,cAGrDS,QAAQC,IAAI,aAEZb,sBAAsBC,cAAeC,SAAUC"}
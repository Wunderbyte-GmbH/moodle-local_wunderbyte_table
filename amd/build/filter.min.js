define("local_wunderbyte_table/filter",["exports","local_wunderbyte_table/search","local_wunderbyte_table/sort","local_wunderbyte_table/init","core/templates"],(function(_exports,_search,_sort,_init,_templates){var obj;
/*
   * @package    local_wunderbyte_table
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getChecked=getChecked,_exports.getDateAndTimePickerDataAsUnix=getDateAndTimePickerDataAsUnix,_exports.getDates=getDates,_exports.getFilterObjects=getFilterObjects,_exports.initializeCheckboxes=initializeCheckboxes,_exports.renderFilter=void 0,_exports.toggleFilterelement=toggleFilterelement,_exports.updateUrlWithFilterSearchSort=function(filterobjects,searchstring,sort,dir){const url=new URL(window.location.href);url.search="",history.replaceState(null,"",url),filterobjects&&url.searchParams.append("wbtfilter",filterobjects);""!==searchstring&&null!==searchstring&&url.searchParams.append("wbtsearch",searchstring);""!==sort&&null!==sort&&url.searchParams.append("tsort",sort);null!==dir&&dir>0&&url.searchParams.append("tdir",dir);window.history.pushState(null,null,url.toString())},_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};var checked={};function initializeCheckboxes(selector,idstring,encodedtable){const filterContainer=document.querySelector(selector+_init.SELECTORS.FILTER);if(!filterContainer||filterContainer.dataset.initialized)return;const selects=filterContainer.querySelectorAll("select[id^='filteroperationselect']"),filterElements=filterContainer.querySelectorAll("input[class^='filterelement']");filterElements&&(checked.hasOwnProperty(idstring)||(checked[idstring]={}),filterElements.forEach((el=>{el.dataset.idstring?el.dataset.idstring2=idstring:el.dataset.idstring=idstring,el.addEventListener("change",(e=>toggleFilterelement(e,selector,idstring,encodedtable)))})),selects&&selects.forEach((el=>{el.dataset.idstring?el.dataset.idstring2=idstring:el.dataset.idstring=idstring,el.addEventListener("change",(e=>toggleFilterelement(e,selector,idstring,encodedtable)))})),filterContainer.dataset.initialized=!0)}function toggleFilterelement(e,selector,idstring,encodedtable){e.stopPropagation(),e.preventDefault(),"dateelement"==e.target.dataset.dateelement?(console.log("dateelement"),getDates(e,selector,idstring)):getChecked(e.target.name,selector,idstring);const filterobjects=getFilterObjects(idstring),searchstring=(0,_search.getSearchInput)(idstring),sort=(0,_sort.getSortSelection)(idstring);(0,_init.callLoadData)(idstring,encodedtable,0,null,sort,null,null,null,filterobjects,searchstring)}function getDates(e,selector,idstring){let name=e.target.name,filtercontainer=e.target.closest(".datepickerform"),filtername=e.target.dataset.filtername,filtercheckbox=filtercontainer.querySelector('input[type="checkbox"][id^="'+filtername+'"][name="'+name+'"]'),dates={};filtercheckbox.checked&&("true"===filtercheckbox.dataset.timespan?function(filtercontainer,filtername,idstring,name){let operator=filtercontainer.querySelector('select[id^="filteroperationselect"][name="'+name+'"]').value,firstcolumn=filtercontainer.querySelector('input[id^="startdate"]').dataset.applytocolumn,firstoperator="",firstColumnValues={},additionalFirstColumnValues={},valuefirstcolumn=getDateAndTimePickerDataAsUnix(filtercontainer,"startdate"),secondcolumn=filtercontainer.querySelector('input[id^="enddate"]').dataset.applytocolumn,secondoperator="",secondColumnValues={},additionalSecondColumnValues={},valuesecondcolumn=getDateAndTimePickerDataAsUnix(filtercontainer,"enddate");checked.hasOwnProperty(filtername)&&(unsetCheckedObject(firstcolumn,filtername,idstring),unsetCheckedObject(secondcolumn,filtername,idstring));switch(operator){case"within":console.log("within switch operator"),firstoperator=">=",secondoperator="<=";break;case"overlapboth":console.log("overlap both switch operator"),firstoperator="<=",secondoperator=">=";break;case"overlapstart":console.log("overlap start switch operator"),firstoperator="<=",additionalFirstColumnValues[">="]=valuesecondcolumn,secondoperator="<=";break;case"overlapend":console.log("overlap end switch operator"),firstoperator="<=",secondoperator="<=",additionalSecondColumnValues["<="]=valuefirstcolumn;break;case"before":console.log("before switch operator"),firstoperator="<",additionalFirstColumnValues["<="]=valuesecondcolumn;break;case"after":console.log("after end switch operator"),secondoperator="<=",additionalSecondColumnValues[">"]=valuesecondcolumn;break;default:console.error("Value of selection not readable")}firstoperator.length>=1&&(firstColumnValues[firstoperator]=valuefirstcolumn);secondoperator.length>=1&&(secondColumnValues[secondoperator]=valuesecondcolumn);firstcolumn&&filtername&&(checked[idstring][firstcolumn]||(checked[idstring][firstcolumn]={}),checked[idstring][firstcolumn][filtername]=new Array(firstColumnValues),Object.keys(additionalFirstColumnValues).length>0&&checked[idstring][firstcolumn][filtername].push(additionalFirstColumnValues));secondcolumn&&filtername&&(checked[idstring][secondcolumn]||(checked[idstring][secondcolumn]={}),checked[idstring][secondcolumn][filtername]=new Array(secondColumnValues),Object.keys(additionalSecondColumnValues).length>0&&checked[idstring][secondcolumn][filtername].push(additionalSecondColumnValues));unsetCheckedObject(firstcolumn,filtername,idstring),unsetCheckedObject(secondcolumn,filtername,idstring)}(filtercontainer,filtername,idstring,name):(dates[filtercheckbox.dataset.operator]=getDateAndTimePickerDataAsUnix(filtercontainer,"datefilter"),name&&filtername&&(checked[idstring][name]||(checked[idstring][name]={}),checked[idstring][name][filtername]=dates),unsetCheckedObject(name,filtername,idstring))),console.log(checked)}function unsetCheckedObject(key1,key2,idstring){Array.isArray(Object.values(checked[idstring][key1][key2]))&&Object.values(checked[idstring][key1][key2][0]).length<1&&delete checked[idstring][key1][key2][0],Object.keys(checked[idstring][key1][key2]).length<1&&delete checked[idstring][key1][key2],Object.keys(checked[idstring][key1]).length<1&&delete checked[idstring][key1]}function getDateAndTimePickerDataAsUnix(filtercontainer){let id=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",datepicker=filtercontainer.querySelector('input[type="date"][id*="'+id+'"]'),date=new Date(datepicker.value),timepicker=filtercontainer.querySelector('input[type="time"][id*="'+id+'"]'),time=timepicker.value,dateTimeString=date.toISOString().split("T")[0]+"T"+time+":00.000Z",unixTimestamp=Date.parse(dateTimeString)/1e3;return unixTimestamp}function getChecked(name,selector,idstring){const wbTable=document.querySelector(selector);checked[idstring][name]=Array.from(wbTable.querySelectorAll("input[name="+name+"]")).filter((function(el){return el.checked})).map((function(el){return el.value})),checked[idstring][name].length<1&&delete checked[idstring][name]}function getFilterObjects(idstring){if(!(idstring in checked))return"";let hasvalues=!1;for(const[,value]of Object.entries(checked[idstring]))(value.length>0||Object.keys(value).length>0)&&(hasvalues=!0);return hasvalues?JSON.stringify(checked[idstring]):""}_exports.renderFilter=(filterjson,idstring,encodedtable)=>{const selector=_init.SELECTORS.CONTAINER+idstring,container=document.querySelector(selector);container.querySelector(_init.SELECTORS.FILTER)||_templates.default.renderForPromise("local_wunderbyte_table/filter",filterjson).then((_ref=>{let{html:html}=_ref;container.insertAdjacentHTML("afterbegin",html),initializeCheckboxes(selector,idstring,encodedtable)})).catch((e=>{console.log(e)}))}}));

//# sourceMappingURL=filter.min.js.map
define("local_wunderbyte_table/init",["exports","core/ajax","core/templates","core/notification","local_wunderbyte_table/search"],(function(_exports,_ajax,_templates,_notification,_search){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_wunderbyte_table
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.isHidden=_exports.init=_exports.callLoadData=void 0,_exports.wbTableReload=function(idstring){let encodedtable=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;idstring=idstring.substring(1);let element=document.getElementById("a"+idstring);if(!element)return void console.log("couldnt find element to reload",idstring);if(!encodedtable&&(encodedtable=element.dataset.encodedtable,!encodedtable))return void console.log("couldnt find encodedtable",encodedtable);callLoadData(idstring,encodedtable)},_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);_exports.init=(idstring,encodedtable)=>{idstring&&encodedtable&&function(idstring,encodedtable,callback){let element=document.getElementById("a"+idstring);if(!element)return;element.dataset.encodedtable=encodedtable;var observer=new MutationObserver((function(){isHidden(element)||(this.disconnect(),callback(idstring,encodedtable))}));for(;null!==element;){if(isHidden(element))return void observer.observe(element,{attributes:!0});element=element.parentElement}callback(idstring,encodedtable)}(idstring,encodedtable,callLoadData)};const isHidden=el=>{var style=window.getComputedStyle(el);return"none"===style.display||"hidden"===style.visibility};_exports.isHidden=isHidden;const callLoadData=function(idstring,encodedtable){let page=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,tsort=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,thide=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,tshow=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,tdir=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,treset=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,table=document.getElementById("a"+idstring),spinner=document.querySelector("#a"+idstring+"spinner .spinner-border");spinner&&spinner.classList.remove("hidden"),table&&table.classList.add("hidden"),_ajax.default.call([{methodname:"local_wunderbyte_table_load_data",args:{encodedtable:encodedtable,page:page,tsort:tsort,thide:thide,tshow:tshow,tdir:tdir,treset:treset},done:function(res){const jsonobject=JSON.parse(res.content),filterjson=JSON.parse(res.filterjson);return _templates.default.renderForPromise(res.template,jsonobject).then((_ref=>{let{html:html,js:js}=_ref;const frag=document.querySelector("#a"+idstring);for(;frag.firstChild;)frag.removeChild(table.lastChild);if(_templates.default.appendNodeContents("#a"+idstring,html,js),!page){const activepage=frag.querySelector("li.page-item active");activepage&&(page=activepage.getAttribute("data-page-number"))}return replaceDownloadLink(idstring,encodedtable,frag),replaceResetTableLink(idstring,encodedtable,frag,page),replacePaginationLinks(idstring,encodedtable,frag),replaceSortColumnLinks(idstring,encodedtable,frag,page),!0})).catch((ex=>{_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})})),(0,_search.renderFilter)(filterjson,idstring),(0,_search.renderSearchbox)(idstring),spinner&&spinner.classList.add("hidden"),table&&table.classList.remove("hidden"),!0},fail:function(err){if(1!=treset)callLoadData(idstring,encodedtable,page,null,null,null,null,1);else{let node=document.createElement("DIV"),textnode=document.createTextNode(err.message);node.appendChild(textnode),table.appendChild(node),spinner.classList.add("hidden"),table.classList.remove("hidden")}}}])};function replaceSortColumnLinks(idstring,encodedtable,frag,page){frag.querySelectorAll("th.header a").forEach((item=>{var sortid=item.getAttribute("data-sortby"),sortorder=item.getAttribute("data-sortorder"),thide="hide"==item.getAttribute("data-action")?item.getAttribute("data-column"):null,tshow="show"==item.getAttribute("data-action")?item.getAttribute("data-column"):null;item.setAttribute("href","#"),item.addEventListener("click",(()=>{callLoadData(idstring,encodedtable,page,sortid,thide,tshow,sortorder)}))}))}function replaceResetTableLink(idstring,encodedtable,frag,page){var arrayOfItems=frag.querySelectorAll("div.resettable");arrayOfItems&&0!=arrayOfItems.length&&arrayOfItems.forEach((item=>{if(item.getAttribute("class").indexOf("resettable")>=0){item.querySelectorAll("a").forEach((subitem=>{subitem.setAttribute("href","#"),subitem.addEventListener("click",(()=>{callLoadData(idstring,encodedtable,page,null,null,null,null,1)}))}))}}))}function replacePaginationLinks(idstring,encodedtable,frag){var arrayOfPageItems=frag.querySelectorAll(".page-item");arrayOfPageItems&&0!=arrayOfPageItems.length&&arrayOfPageItems.forEach((item=>{let pageNumber=item.dataset.pagenumber;pageNumber&&(--pageNumber,item.addEventListener("click",(()=>{callLoadData(idstring,encodedtable,pageNumber)})))}))}function replaceDownloadLink(idstring,encodedtable,frag){frag.querySelectorAll("form").forEach((item=>{if("FORM"==item.tagName){item.setAttribute("method","POST");let newnode=document.createElement("input");newnode.setAttribute("type","hidden"),newnode.setAttribute("name","encodedtable"),newnode.setAttribute("value",encodedtable),item.appendChild(newnode)}}))}_exports.callLoadData=callLoadData}));

//# sourceMappingURL=init.min.js.map
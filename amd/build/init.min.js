define ("local_wunderbyte_table/init",["exports","core/ajax","core/templates","core/notification","local_wunderbyte_table/filter","local_wunderbyte_table/search","local_wunderbyte_table/sort","local_wunderbyte_table/reload"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.callLoadData=a.isHidden=a.init=void 0;b=i(b);c=i(c);d=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var t={},u={},v={},w={};a.init=function init(a,b){console.log("wb init",a);if(a&&b){if(!u.hasOwnProperty(a)){u[a]=0}j(a,b,y)}};function j(a,b,c){var d="a"+a,i=document.querySelector("#"+d);if(i&&!i.dataset.encodedtable){i.dataset.encodedtable=b}else{console.log("wb didnnt find element aborted",d);return}var j=document.querySelector("#"+d+"spinner");if(null!==j&&!x(j)){var k=new MutationObserver(function(){if(!x(i)){this.disconnect();c(a,b)}}),m=n(i);if(null!==m){k.observe(m,{attributes:!0})}else{c(a,b)}}else{s(a,b,i,null);var o=".wunderbyte_table_container_"+a;(0,e.initializeCheckboxes)(o,a,b);(0,f.initializeSearch)(o,a,b);(0,g.initializeSort)(o,a,b);(0,h.initializeReload)(o,a,b);l(a,b,i)}}function k(a){if(null===a){return null}if(a.scrollHeight>a.clientHeight){return a}else{return k(a.parentNode)}}var x=function(a){var b=window.getComputedStyle(a);return"none"===b.display||"hidden"===b.visibility};a.isHidden=x;var y=function(a,h){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,j=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,k=4<arguments.length&&arguments[4]!==void 0?arguments[4]:null,m=5<arguments.length&&arguments[5]!==void 0?arguments[5]:null,n=6<arguments.length&&arguments[6]!==void 0?arguments[6]:null,o=7<arguments.length&&arguments[7]!==void 0?arguments[7]:null,p=8<arguments.length&&arguments[8]!==void 0?arguments[8]:null,q=9<arguments.length&&arguments[9]!==void 0?arguments[9]:null,r=10<arguments.length&&arguments[10]!==void 0?arguments[10]:!1;if(t[a]){return}if(null!==i){u[a]=i}if(null===p){p=(0,e.getFilterOjects)(a)}if(null===q){q=(0,f.getSearchInput)(a)}if(null===j){j=(0,g.getSortSelection)(a)}var w=document.getElementById("a"+a),x=document.querySelector("#a"+a+"spinner .spinner-border");if(0==u[a]&&!r){if(x){x.classList.remove("hidden")}if(w){w.classList.add("hidden")}}t[a]=!0;b.default.call([{methodname:"local_wunderbyte_table_load_data",args:{encodedtable:h,page:i,tsort:j,thide:k,tshow:m,tdir:n,treset:o,filterobjects:p,searchtext:q},done:function done(b){var j=JSON.parse(b.content),k=b.template,m=document.querySelector(".wunderbyte_table_container_"+a),n=m.querySelector(".wunderbyte_table_components");if(r||0<u[a]){var z=k+"_row";if(!j.table.hasOwnProperty("rows")){u[a]=-1;t[a]=!1;return}var o=j.table.rows,q=o.map(function(b){c.default.renderForPromise(z,b).then(function(b){var d=b.html,e=b.js;if(r){var f=JSON.parse(p),g=f.id;c.default.replaceNode("#a"+a+" .rows-container tr[data-id='"+g+"']",d,e)}else{c.default.appendNodeContents("#a"+a+" .rows-container",d,e)}return!0}).catch(function(a){console.log(a)});return!0});if(!v.hasOwnProperty(a)){var A=c.default.renderForPromise(k,j).then(function(b){var c=b.html,d=b.js;v[a]=d;return!0}).catch(function(a){console.log(a)});q.push(A)}Promise.all(q).then(function(){setTimeout(function(){c.default.appendNodeContents("#a"+a,"",v[a])},100);t[a]=!1}).catch(function(a){console.log(a)});return}if(!n){k=k+"_container"}var y=m.querySelector(".wunderbyteTableClass");c.default.renderForPromise(k,j).then(function(b){var d=b.html,j=b.js;if(n){while(y.firstChild){y.removeChild(y.lastChild)}c.default.appendNodeContents("#a"+a,d,j)}else{var p=m.parentElement;m.remove();c.default.appendNodeContents(p,d,j);m=document.querySelector(".wunderbyte_table_container_"+a)}s(a,h,m,i);t[a]=!1;if(x){x.classList.add("hidden")}if(w){w.classList.remove("hidden")}var k=".wunderbyte_table_container_"+a;(0,e.initializeCheckboxes)(k,a,h);(0,f.initializeSearch)(k,a,h);(0,g.initializeSort)(k,a,h);var o=m.querySelector("#a"+a);l(a,h,o);return!0}).catch(function(b){t[a]=!1;d.default.addNotification({message:"failed rendering "+b,type:"danger"})})},fail:function fail(b){if(1!=o){y(a,h,i,null,null,null,null,1)}else{var c=document.createElement("DIV"),d=document.createTextNode(b.message);c.appendChild(d);w.appendChild(c);x.classList.add("hidden");w.classList.remove("hidden")}}}])};a.callLoadData=y;function l(a,b,c){console.log("addScrollFunctionality");if(c.dataset.scrollinitialized){return}c.dataset.scrollinitialized=!0;var d=k(c);console.log(d);d.addEventListener("scroll",function(){if(!w.hasOwnProperty(a)){w[a]="scrollElement"}else{if("scrollElement"===w[a]){m(c,a,b)}}});window.addEventListener("scroll",function(){if(!w.hasOwnProperty(a)){w[a]="window"}else{if("window"===w[a]){m(c,a,b)}}})}function m(a,b,c){if(n(a)){return}var d=a.getBoundingClientRect().top,e=a.getBoundingClientRect().height,f=document.body.scrollHeight;if(!t[b]&&0<=u[b]){if(0>d+e-f){u[b]=u[b]+1;y(b,c,u[b],null,null,null,null,null,null,null)}}}function n(a){while(null!==a){if(!x(a)){a=a.parentElement}else{return a}}return null}function o(a,b,c,d){var e=c.querySelectorAll("th.header a");e.forEach(function(c){var e=c.getAttribute("data-sortby"),f=c.getAttribute("data-sortorder"),g="hide"==c.getAttribute("data-action")?c.getAttribute("data-column"):null,h="show"==c.getAttribute("data-action")?c.getAttribute("data-column"):null;c.setAttribute("href","#");c.addEventListener("click",function(){y(a,b,d,e,g,h,f)})})}function p(a,b,c,d){var e=c.querySelectorAll("div.resettable");if(!e||0==e.length){return}e.forEach(function(c){var e=c.getAttribute("class");if(0<=e.indexOf("resettable")){var f=c.querySelectorAll("a");f.forEach(function(c){c.setAttribute("href","#");c.addEventListener("click",function(){y(a,b,d,null,null,null,null,1)})})}})}function q(a,b,c){var d=c.querySelectorAll(".page-item");if(!d||0==d.length){return}d.forEach(function(c){var d=c.dataset.pagenumber;if(d){--d;c.addEventListener("click",function(){y(a,b,d)})}})}function r(a,b,c){var d=c.querySelectorAll("form");d.forEach(function(a){if("FORM"==a.tagName){a.setAttribute("method","POST");var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name","encodedtable");c.setAttribute("value",b);a.appendChild(c)}})}function s(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;if(!d){var e=c.querySelector("li.page-item active");if(e){d=e.getAttribute("data-page-number")}}r(a,b,c);p(a,b,c,d);q(a,b,c);o(a,b,c,d)}});
//# sourceMappingURL=init.min.js.map

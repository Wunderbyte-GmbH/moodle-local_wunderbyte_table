define ("local_wunderbyte_table/init",["exports","core/ajax","core/templates","core/notification","local_wunderbyte_table/search"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.wbTableReload=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;a=a.substring(1);var c=document.getElementById("a"+a);if(!c){return}if(!b){b=c.dataset.encodedtable;if(!b){return}}q(a,b)};a.callLoadData=a.isHidden=a.init=void 0;b=f(b);c=f(c);d=f(d);function f(a){return a&&a.__esModule?a:{default:a}}var m=!1,n=0,o=null;a.init=function init(a,b){if(a&&b){g(a,b,q)}};function g(a,b,c){var d="a"+a,f=document.getElementById(d);if(f&&!f.dataset.encodedtable){f.dataset.encodedtable=b}else{return}var g=document.getElementById(d+"spinner");if(null!==g&&!p(g)){c(a,b);var h=new MutationObserver(function(){if(!p(f)){this.disconnect();c(a,b)}});while(null!==f){if(!p(f)){f=f.parentElement}else{h.observe(f,{attributes:!0});return}}}else{l(a,b,f,null);(0,e.initializeCheckboxes)(".wunderbyte_table_container_"+a,a,b)}if(f.dataset.scrollinitialized){return}f.dataset.scrollinitialized=!0;window.addEventListener("scroll",function(){if(!m&&0<=n){if(window.scrollY+window.innerHeight>=f.scrollHeight-100){console.log("load more data",window.scrollY,window.scrollY+window.innerHeight,document.body.scrollHeight);n++;console.log("call load for scroll",n);q(a,b,n,null,null,null,null,null,null,null)}}})}var p=function(a){var b=window.getComputedStyle(a);return"none"===b.display||"hidden"===b.visibility};a.isHidden=p;var q=function(a,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:null,j=5<arguments.length&&arguments[5]!==void 0?arguments[5]:null,k=6<arguments.length&&arguments[6]!==void 0?arguments[6]:null,p=7<arguments.length&&arguments[7]!==void 0?arguments[7]:null,r=8<arguments.length&&arguments[8]!==void 0?arguments[8]:null,s=9<arguments.length&&arguments[9]!==void 0?arguments[9]:null;if(m){return}if(null!==g){n=g}if(null===r){r=(0,e.getFilterOjects)()}var t=document.getElementById("a"+a),u=document.querySelector("#a"+a+"spinner .spinner-border");if(0==n){if(u){u.classList.remove("hidden")}if(t){t.classList.add("hidden")}}m=!0;b.default.call([{methodname:"local_wunderbyte_table_load_data",args:{encodedtable:f,page:g,tsort:h,thide:i,tshow:j,tdir:k,treset:p,filterobjects:r,searchtext:s},done:function done(b){console.log(b);var e=JSON.parse(b.content),h=b.template,j=!0,k=document.querySelector(".wunderbyte_table_container_"+a),p=k.querySelector(".wunderbyteTableFilter");if(0<n){var q=h.lastIndexOf("/"),i=h.substring(0,q);i+="/row";console.log(i,h);if(!e.table.hasOwnProperty("rows")){n=-1;m=!1;return}var s=e.table.rows;console.log(h,s);var v=s.map(function(b){c.default.renderForPromise(i,b).then(function(b){var d=b.html,e=b.js;c.default.appendNodeContents("#a"+a+" div.rows",d,e);return!0}).catch(function(a){console.log(a)})});if(null===o){var w=c.default.renderForPromise(h,e).then(function(a){var b=a.html,c=a.js;o=c;return!0}).catch(function(a){console.log(a)});v.push(w)}Promise.all(v).then(function(){console.log(v.length);setTimeout(function(){c.default.appendNodeContents("#a"+a,"",o);console.log("just added js to page "+g+" "+s)},100);m=!1}).catch(function(a){console.log(a)});return}else if(p){var x=h.lastIndexOf("/");h=h.substring(0,x);h+="/table";j=!1}var r=k.querySelector(".wunderbyteTableClass");c.default.renderForPromise(h,e).then(function(b){var d=b.html,e=b.js;if(!j){while(r.firstChild){r.removeChild(r.lastChild)}c.default.appendNodeContents("#a"+a,d,e)}else{var h=k.parentElement;k.remove();c.default.appendNodeContents(h,d,e);k=document.querySelector(".wunderbyte_table_container_"+a)}l(a,f,k,g);m=!1;return!0}).catch(function(a){m=!1;d.default.addNotification({message:"failed rendering "+a,type:"danger"})});if(u){u.classList.add("hidden")}if(t){t.classList.remove("hidden")}return!0},fail:function fail(b){if(1!=p){q(a,f,g,null,null,null,null,1)}else{var c=document.createElement("DIV"),d=document.createTextNode(b.message);c.appendChild(d);t.appendChild(c);u.classList.add("hidden");t.classList.remove("hidden")}}}])};a.callLoadData=q;function h(a,b,c,d){var e=c.querySelectorAll("th.header a");e.forEach(function(c){var e=c.getAttribute("data-sortby"),f=c.getAttribute("data-sortorder"),g="hide"==c.getAttribute("data-action")?c.getAttribute("data-column"):null,h="show"==c.getAttribute("data-action")?c.getAttribute("data-column"):null;c.setAttribute("href","#");c.addEventListener("click",function(){q(a,b,d,e,g,h,f)})})}function i(a,b,c,d){var e=c.querySelectorAll("div.resettable");if(!e||0==e.length){return}e.forEach(function(c){var e=c.getAttribute("class");if(0<=e.indexOf("resettable")){var f=c.querySelectorAll("a");f.forEach(function(c){c.setAttribute("href","#");c.addEventListener("click",function(){q(a,b,d,null,null,null,null,1)})})}})}function j(a,b,c){var d=c.querySelectorAll(".page-item");if(!d||0==d.length){return}d.forEach(function(c){var d=c.dataset.pagenumber;if(d){--d;c.addEventListener("click",function(){q(a,b,d)})}})}function k(a,b,c){var d=c.querySelectorAll("form");d.forEach(function(a){if("FORM"==a.tagName){a.setAttribute("method","POST");var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name","encodedtable");c.setAttribute("value",b);a.appendChild(c)}})}function l(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;if(!d){var e=c.querySelector("li.page-item active");if(e){d=e.getAttribute("data-page-number")}}k(a,b,c);i(a,b,c,d);j(a,b,c);h(a,b,c,d)}});
//# sourceMappingURL=init.min.js.map

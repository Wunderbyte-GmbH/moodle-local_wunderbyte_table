{"version":3,"file":"initcalendar.min.js","sources":["../src/initcalendar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {\n    get_strings as getStrings,\n} from 'core/str';\n\n/**\n * [Description for init]\n *\n * @param {string} id\n * @return [type]\n *\n */\nexport async function init(id) {\n\n    const calendarElement = document.getElementById(id);\n    const data = calendarElement.dataset.rowswithdates;\n    const datesobject = JSON.parse(data);\n\n    const isLeapYear = (year) => {\n        return (\n            (year % 4 === 0 && year % 100 !== 0 && year % 400 !== 0) ||\n            (year % 100 === 0 && year % 400 === 0)\n        );\n    };\n    const getFebDays = (year) => {\n        return isLeapYear(year) ? 29 : 28;\n    };\n    let calendar = document.querySelector('.calendar');\n\n    const strings = [\n        {\n            key: 'january',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'february',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'march',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'april',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'may',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'june',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'july',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'august',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'september',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'october',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'november',\n            component: 'local_wunderbyte_table',\n        },\n        {\n            key: 'december',\n            component: 'local_wunderbyte_table',\n        },\n    ];\n\n    const localizedstrings = await getStrings(strings);\n    const monthNames = localizedstrings;\n    let monthPicker = document.querySelector('#month-picker');\n    const dayTextFormate = document.querySelector('.day-text-formate');\n    const timeFormate = document.querySelector('.time-formate');\n    const dateFormate = document.querySelector('.date-formate');\n\n    monthPicker.onclick = () => {\n        monthList.classList.remove('hideonce');\n        monthList.classList.remove('hide');\n        monthList.classList.add('show');\n        dayTextFormate.classList.remove('showtime');\n        dayTextFormate.classList.add('hidetime');\n        timeFormate.classList.remove('showtime');\n        timeFormate.classList.add('hideTime');\n        dateFormate.classList.remove('showtime');\n        dateFormate.classList.add('hideTime');\n    };\n\n    const generateCalendar = (month, year) => {\n        const highlightSessions = [];\n        datesobject.forEach(session => {\n            const date = new Date(session.coursestarttime * 1000);\n            const object = {url: session.url, timestamp: date};\n            highlightSessions.push(object);\n        });\n        let calendarDays = document.querySelector('.calendar-days');\n        calendarDays.innerHTML = '';\n        let calendarHeaderYear = document.querySelector('#year');\n        let daysOfMonth = [\n            31,\n            getFebDays(year),\n            31,\n            30,\n            31,\n            30,\n            31,\n            31,\n            30,\n            31,\n            30,\n            31,\n        ];\n\n        monthPicker.innerHTML = monthNames[month];\n\n        calendarHeaderYear.innerHTML = year;\n\n        let firstDay = new Date(year, month);\n\n        for (let i = 0; i <= daysOfMonth[month] + firstDay.getDay() - 1; i++) {\n            let day = document.createElement('div');\n            if (i >= firstDay.getDay()) {\n                let dayNumber = i - firstDay.getDay() + 1;\n                day.innerHTML = dayNumber;\n\n                let dayDate = new Date(year, month, dayNumber);\n\n                let matchedHighlightSession = null;\n                let isHighlighted = highlightSessions.some(highlightSession => {\n                    if (highlightSession.timestamp.getDate() === dayDate.getDate() &&\n                        highlightSession.timestamp.getMonth() === dayDate.getMonth() &&\n                        highlightSession.timestamp.getFullYear() === dayDate.getFullYear()) {\n                        matchedHighlightSession = highlightSession; // Store the matched session\n                        return true;\n                    }\n                    return false;\n                });\n\n                if (isHighlighted && matchedHighlightSession) {\n                    day.classList.add('highlight-date'); // Add a class to highlight\n\n                    // Create an <a> element with the specified class and href\n                    let link = document.createElement('a');\n                    link.classList.add('stretched-link');\n                    link.href = matchedHighlightSession.url;\n                    // Insert the <a> element into the div\n                    day.appendChild(link);\n                }\n\n            }\n            calendarDays.appendChild(day);\n        }\n    };\n\n    let monthList = calendar.querySelector('.month-list');\n    monthNames.forEach((e, index) => {\n        let month = document.createElement('div');\n        month.innerHTML = `<div>${e}</div>`;\n\n        monthList.append(month);\n        month.onclick = () => {\n            currentMonth.value = index;\n            generateCalendar(currentMonth.value, currentYear.value);\n            monthList.classList.replace('show', 'hide');\n            dayTextFormate.classList.remove('hideTime');\n            dayTextFormate.classList.add('showtime');\n            timeFormate.classList.remove('hideTime');\n            timeFormate.classList.add('showtime');\n            dateFormate.classList.remove('hideTime');\n            dateFormate.classList.add('showtime');\n        };\n    });\n    (function() {\n        monthList.classList.add('hideonce');\n    })();\n    document.querySelector('#pre-year').onclick = () => {\n        --currentYear.value;\n        generateCalendar(currentMonth.value, currentYear.value);\n    };\n    document.querySelector('#next-year').onclick = () => {\n        ++currentYear.value;\n        generateCalendar(currentMonth.value, currentYear.value);\n    };\n\n    let currentDate = new Date();\n    let currentMonth = {value: currentDate.getMonth()};\n    let currentYear = {value: currentDate.getFullYear()};\n    generateCalendar(currentMonth.value, currentYear.value);\n}\n"],"names":["id","data","document","getElementById","dataset","rowswithdates","datesobject","JSON","parse","getFebDays","year","isLeapYear","calendar","querySelector","monthNames","key","component","monthPicker","dayTextFormate","timeFormate","dateFormate","onclick","monthList","classList","remove","add","generateCalendar","month","highlightSessions","forEach","session","date","Date","coursestarttime","object","url","timestamp","push","calendarDays","innerHTML","calendarHeaderYear","daysOfMonth","firstDay","i","getDay","day","createElement","dayNumber","dayDate","matchedHighlightSession","some","highlightSession","getDate","getMonth","getFullYear","link","href","appendChild","e","index","append","currentMonth","value","currentYear","replace","currentDate"],"mappings":"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"}